"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Date.prototype.format||(Date.prototype.format=function(e){return Lure._DateFormat(this,e)});var Lure=function(){var LureClass=function(){function LureClass(){_classCallCheck(this,LureClass),this.Plugin={};var $this=this;this.Debug=!1,this.isEditableEventsEnabled=!1;var regexEach=new RegExp(/{{#each\s+([^}]+)}}/g),regexIfOuter=new RegExp(/{{#if\s+([^}]+)}}([\s\S]*?){{#endif}}/g),regexIfInner=new RegExp(/{{#if([\s\S]*?)}}/g),regexExpressions=new RegExp(/{{([^#}]+)}}/g),regexEditable=new RegExp(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/g),spaces="    ",preCompileIfOuter=function(e){return e=e.replace(/#IF/g,"#if").replace(/#ENDIF/g,"#endif").replace(regexIfOuter,function(e,t,i){return'`+\n/* OUTER "IF" */\n(function($this){\n    if ('+preParseObjectChecker(t)+") {\n        return `"+i+"`;\n    }\n    return '';\n})($this)+`"})},preCompileIfInner=function(e){return e=e.replace(regexIfInner,function(e,t){return t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/g," < ").replace(/#more/g," > ").replace(/&amp;/g,"&").replace(/\|/g,'"'),'`+\n    /* LOCAL "IF" */\n    (function(){\n        return ('+t+"); \n        return '';})()+`"})},preCompileEach=function(e){e=e.replace(/{{#EACH/g,"{{#each").replace(/{{#ENDEACH/g,"{{#endeach");var t=e.match(regexEach),i=0;if(null!==t)for(var n=t.length-1;n>=0;n--){var r=t[n],a=!1;i++;var o=e.indexOf(r),l=e.indexOf("{{#endeach}}",o),s=e.slice(0,o).match(regexEach);s=null!==s?s.length:0;var c=e.slice(0,o).match(/{{#endeach}}/g);c=null!==c?c.length:0,s>c&&(a=!0,i=0);var u=e.slice(o,l+12),d=u.slice(r.length,u.length-12),h=r.replace(/{{#each\s+([\s\S]+)}}/,function(e,t){return t});h=preParseObjectChecker(h);var f="`+"+spaces.repeat(i)+"/* EACH */(function(inner, $parent){                                                                   \r\n"+spaces.repeat(i)+"    if (!inner || (Object.keys(inner).length === 0 && inner.constructor === Object && isNaN(inner)))   \r\n"+spaces.repeat(i)+'        return "";                                                                                     \r\n'+spaces.repeat(i)+'    let string_result= "";                                                                             \r\n'+spaces.repeat(i)+"    for(let j = 0; j < inner.length; j++){                                                             \r\n"+spaces.repeat(i)+"        let $this = inner[j];                                                                          \r\n"+spaces.repeat(i)+"        let o = inner[j];                                                                              \r\n"+spaces.repeat(i)+"        string_result = string_result + `"+preParse(d)+"`;                                \r\n"+spaces.repeat(i)+"    }                                                                                                  \r\n"+spaces.repeat(i)+"    return string_result;                                                                              \r\n"+spaces.repeat(i)+"})("+h+', {$parent: typeof $parent !== "undefined"?$parent:null, $this: $this, i: i} ) +`         ';e=e.replace(u,f)}return e},preCompileEditable=function(e){return e.replace(regexEditable,function(e,t,i){return e=e.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(t,' data-line="{{i}}" data-property="'+i.replace("{{","").replace("}}","")+'">')}),e.replace(i,'<div class="editable-helper editable-value">'+i+'</div><div class="editable-helper editable-icon"></div>')})},preParseObjectChecker=function(e){function t(e){var t=e.replace(/\s/g,""),i=t.indexOf("$item")>-1||t.indexOf("$this")>-1||t.indexOf("$parent")>-1,n=t.indexOf("$index")>-1||t.indexOf("$j")>-1||t.indexOf("$key")>-1||t.indexOf("$lvl")>-1||t.indexOf("$g.")>-1,r="?"===t||t.indexOf("=")>-1||t.indexOf(">")>-1||t.indexOf("<")>-1,a=null!==t.match(/^["'\\][\s\S]*["'\\]$/),o="i"===t||"j"===t,l=!isNaN(t);return i||n||o||l||a||r?t.indexOf("$g.")>-1?t.replace("$g.",""):e:"o."+t}return e.indexOf("Available + Dis")>-1,e=e.replace(/[^\-+\/%()*]+/g,function(e){var i=e.match(/&/g);if(null!==i){for(var n=0;n<i.length;n++)e=n<i.length-1?e.replace("&","$parent"):e.replace("&","$parent.$this");return e}return t(e)}),e=e.replace(/\\'/g,"'"),e="("+e+")"},preParse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(regexExpressions,function(e,i){return t?"${"+preParseObjectChecker(i)+"}":"${"+i+"}"})};this.Compile=function(e,t){e=e.replace(/[\n]+/g," ").replace(/[ ]{3,}/g,""),e=e.replace(/'/g,"\\'"),t&&(e=preCompileEditable(e),e=preCompileIfOuter(e),e=preCompileEach(e)),e=preParse(e),e=preCompileIfInner(e);var i="\nlet $this = o;\nlet $item = o;\nlet $num = i+1;\nlet $denum = length-i;\n//treebuilder's\nlet $index;\nlet $key;\nlet $lvl;\nlet $j;\nif (extra){\n    $index = extra.$index;\n    $key = extra.$key;\n    $lvl = extra.$lvl;\n    $j = extra.$j;\n}\nlet string_Result = \"\";\nif (o === undefined || (Object.keys(o).length === 0 && o.constructor === Object && isNaN(o)) ) \n    return '';\nreturn `";i+=e+"`;",i=i.replace(/`/g,"'").replace(/\$\{([^}]*)\}/g,function(e,t){return"'+"+t+"+'"});var n=void 0;try{n=new Function("o","i","length","extra",i)}catch(r){console.info(i),console.error(r)}return n},this._EditablesEventListenerRun=function(e){$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("click",".editable-icon",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget.closest(".editable"))},e),$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("change",".editable-editor",function(e){var t=e.currentTarget.value,i=e.currentTarget.parentElement.dataset.value;t!==i?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("keyup",".editable-textbox",function(e){if(13===e.keyCode)return $this.Editable.Save(e.currentTarget.closest(".editable"),e.currentTarget.value),!1;var t=e.currentTarget.value,i=e.currentTarget.parentElement.dataset.value;t!==i?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("click",".editable-save-button",function(e){var t=e.currentTarget.closest(".editable");$this.Editable.Save(e.currentTarget.closest(".editable"),t.querySelector(".editable-editor").value)},e),$this.isHasEditablesEventsEnabled||(document.addEventListener("click",function(e){e.target.classList.contains("editable-helper")&&null!==document.querySelectorAll(".editable-helper, .editable-editing")||$this.Editable.RemoveEdits()}),$this.isHasEditablesEventsEnabled=!0)},this.CreateElementFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(t);for(n.innerHTML=e;n.childNodes[0];)i.appendChild(n.childNodes[0]);return i.childNodes[0]},this.CreateElementsFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(t);for(n.innerHTML=e;n.childNodes[0];)i.appendChild(n.childNodes[0]);if(i.childNodes.length>0){for(var r=[],a=0;a<i.childNodes.length;a++)r.push(i.childNodes[a]);return r}return null},this.Select=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return""===e||null===e?null:e instanceof Node?e:t.querySelector(e)},this.SelectAll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"undefined"==typeof e?[]:"undefined"!=typeof e.tagName||e===document?[e]:t.querySelectorAll(e)},this.AddEventListenerGlobal=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,r=arguments[4];n.addEventListener(e,function(e){var a=e.target,o=!1,l=Lure._EventClone(e),s=n.querySelectorAll(t);if(s[0]===a&&(l.currentTarget=a,o=!0),!o)for(var c=0;c<s.length;c++)if(s[c].contains(a)){o=!0,l.currentTarget=a.closest(t);break}o&&i.call(r?r:l.currentTarget,l)})},this.isVisible=function(e){var t=function(e){var t=window.getComputedStyle(e);return"none"!==t.display&&"0"!==t.opacity&&"hidden"!==t.visibility&&((0!==parseInt(t.minWidth)&&"auto"!==t.minWidth||0!==parseInt(t.width))&&(0!==parseInt(t.minHeight)&&"auto"!==t.minHeight||0!==parseInt(t.height)))},i=function(e){for(;e.parentElement;){if(!t(e.parentElement))return!1;e=e.parentElement}return!0};return!!t(e)&&i(e)},this._EventClone=function(e){function t(){}var i=new t;for(var n in e){var r=Object.getOwnPropertyDescriptor(e,n);!r||r.writable&&r.configurable&&r.enumerable&&!r.get&&!r.set?i[n]=e[n]:Object.defineProperty(i,n,r)}return Object.setPrototypeOf(i,e),i},this.GetFileText=function(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.onload=function(){t(n.response)},n.onerror=function(){i(new Error("XMLHttpRequest Error: "+this.statusText))},e=e.indexOf("..")>-1?e.replace("..",document.location.protocol+"//"+document.location.host):document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+e,console.log("Lure.GetFileText",e),n.open("GET",e),n.send()})},this.GetInlineSize=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1rem",i="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",n=document.createElement("div");for(var r in e.style)try{""!==e.style[r]&&e.style[r].indexOf(":")>0&&(n.style[r]=e.style[r])}catch(a){}document.all?n.style.setAttribute("cssText",i):n.setAttribute("style",i),n.style.fontSize=t,n.innerHTML=e.innerHTML,parent.document.body.appendChild(n);var o={width:n.clientWidth,height:n.clientHeight};return parent.document.body.removeChild(n),o},this.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this._DateFormat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD.MM.YYYY HH:mm:ss";if(null===e||"undefined"==typeof e)return"";var i=e.getDate(),n=e.getMonth(),r=e.getFullYear(),a=e.getHours(),o=e.getMinutes(),l=e.getSeconds();return t.replace("DD",i.toString().length<2?"0"+i:i).replace("D",i).replace("MMM",$this.Culture.MonthNames[n]).replace("MM",n.toString().length<2?"0"+n:n).replace("M",n).replace("YYYY",r).replace("YY",r.toString().substring(2,2)).replace("Y",r).replace("HH",a.toString().length<2?"0"+a:a).replace("hh",a).replace("mm",o.toString().length<2?"0"+o:o).replace("ss",l.toString().length<2?"0"+l:l)},this.Editable={EditMode:!1,RemoveWaiting:function(){var e=document.querySelectorAll(".editable-waiting");e.forEach(function(e){e.classList.remove("editable-waiting")})},RemoveEdits:function(){if(!$this.Editable.EditMode){var e=document.querySelectorAll(".editable-editing");e.forEach(function(e){e.innerHTML=e._innerHTML,e.classList.remove("editable-editing")}),$this.Editable.RemoveWaiting()}},AddEdits:function AddEdits(EditableElement){EditableElement._innerHTML=EditableElement.innerHTML;var ValuePrev=EditableElement.querySelector(".editable-value").innerHTML;EditableElement.classList.add("editable-editing"),EditableElement.dataset.value=ValuePrev;var SaveButton=$this.Editable.EditMode?"":'<div class="editable-helper editable-save-button"></div>';if(EditableElement.dataset.object){var string_Select='<select class="select editable-helper editable-editor editable-select">',SelectData=eval(EditableElement.dataset.object),Property=EditableElement.dataset.property,SelectOptions="";SelectData.forEach(function(e){var t="";if(("undefined"==typeof e?"undefined":_typeof(e))===_typeof({})){for(var i in e)t+=" data-property_"+i+'="'+e[i]+'"';string_Select+='<option class="editable-helper" '+t+">"+e[Property]+"</option>"}else string_Select+='<option class="editable-helper" '+(e===ValuePrev?"selected":"")+">"+e+"</option>"}),string_Select+="</select>"+SaveButton+"</div>",EditableElement.innerHTML=string_Select}else{var EditType=EditableElement.dataset.type;"undefined"==typeof EditType&&(EditType="text"),EditableElement.innerHTML='<input class="textbox editable-helper editable-editor editable-textbox" type="'+EditType+'" value="'+ValuePrev+'"> '+SaveButton,EditableElement.querySelector(".editable-editor").focus(),EditableElement.querySelector(".editable-editor").select()}},Save:function(e,t){var i=e.closest(".mt-content"),n=i.MonsieurController,r=e.dataset.line,a=e.dataset.property,o=n.Data[r];return""===t||null===t||"undefined"==typeof t?(console.info("New Value is empty"),void Lure.ErrorHint(e,"Пустое поле или неправильные данные")):(e.innerHTML=e._innerHTML,e.dataset.value=t,e.querySelector(".editable-value").innerHTML=t,e.classList.remove("editable-editing"),"$this"!==a&&"$item"!==a?o[a]=t:o=t,void n.LineSave(r,a,t,function(){Lure.Editable.RemoveWaiting(),"$this"!==a&&"$item"!==a?n.Data[r][a]=t:n.Data[r]=t}))}},this.Settings={DialogBlur:null,DialogAnimation:"lure-animation-dialog",EditableClass:"editable",EditableWaiting:"editable-waiting"},this.Culture={MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesShort:["янв.","фев.","мар.","апр.","май","июн.","июл.","авг.","сен.","окт.","ноя.","дек."],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]},this.TemplatorList=[],this.ContentList={},this._DialogCount=0}return _createClass(LureClass,[{key:"Perf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Perf",i=Math.floor(100*(window.performance.now()-e))/100;return console.info("["+t+"]: "+i+"ms"),i}},{key:"Confirm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Achtung",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.CaptionColor,r=void 0===n?"":n,a=i.CaptionBackground,o=void 0===a?"":a,l=i.OnAgree,s=void 0===l?function(){}:l,c=i.OnCancel,u=void 0===c?null:c;document.activeElement.blur();var d=document.createElement("div");d.classList.add("lure-confirm"),Lure.Settings.DialogAnimation&&d.classList.add(Lure.Settings.DialogAnimation);var h=document.createElement("div");h.classList.add("cd-caption"),h.innerHTML=e,h.style.color=r,h.style.background=o,d.appendChild(h);var f=document.createElement("div");f.classList.add("cd-text"),f.innerHTML=t,d.appendChild(f);var p=document.createElement("div");p.classList.add("cd-buttons"),d.appendChild(p);var g=document.createElement("div");if(g.classList.add("button","cd-button","btn-diag-confirm"),g.innerHTML="Ok",g.onclick=function(){Lure._DialogCount--,null!==s&&void 0!==s&&s(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),m.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(g),null!==u){var v=document.createElement("div");v.classList.add("button","cd-button","btn-diag-cancel"),v.innerHTML="Отмена",v.onclick=function(){Lure._DialogCount--,null!==u&&u(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),m.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(v)}var m=document.createElement("div");m.classList.add("ConfirmDialog-wrapper"),document.body.appendChild(m),document.body.appendChild(d),Lure._DialogCount++,Lure.Settings.DialogBlur&&(m.style.background="none",Lure.Select(Lure.Settings.DialogBlur).classList.add("lure-blur"))}},{key:"NoFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==e&&(e='"'+e+'"'),this.Confirm("Error","Sorry, function "+e+" is not available yet")}},{key:"ErrorHint",value:function(e,t){t||(t="Поле не может быть пустым");var i=document.createElement("div");i.classList.add("lure-error-hint"),i.innerHTML=t,e.parentElement.style.position="relative",e.parentElement.appendChild(i),i.style.display="block";try{i.animate({opacity:[0,1]},{duration:300})}catch(n){}setTimeout(function(){try{i.animate({opacity:[1,0]},{duration:300}).onfinish=function(){i.style.display="none"}}catch(t){i.style.display="none"}setTimeout(function(){e.parentElement.style.position="",i.remove()},500)},2e3)}}]),LureClass}();return new LureClass}();Lure.Plugin.Content={Version:"0.9.1",Content:function(){function LureContent(_ref2){function MakeContent(e){null===Controller||Array.isArray(Controller.Data)?this.Content=Lure.CreateElementFromString(e):null===Controller||Array.isArray(Controller.Data)||(e=e.replace(/>[^>]*({{[^#}]+}})[^>]*</g,function(e,t){var i=e.replace(/{{[^#}]+}}/g,function(e){return"<span>"+e+"</span>"});return i}),this.Content=Lure.CreateElementFromString(e)),this.Target.appendChild(this.Content)}function construct(){this.Type=Type,this.Name=Name,this.AllContents=Lure.ContentList,this.Refresh=Refresh.bind(this),this.Select=function(e){return Lure.Select(e,$this.Content)},this.SelectAll=function(e){return Lure.SelectAll(e,$this.Content)},this.GetParent=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",t=$this;null!==t.Parent&&t.Name!==e;)t=t.Parent;return t},this.GetContent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",t=this.GetParent(e);if(t.Name===e)return t;var i=t;if("root"===e)return i;var n=function r(t){for(var n in t)if("Parent"!==n&&t[n]&&t[n].isContent){if(t[n].Name===e)return t[n];i=r(t[n])}return i};return n(i)},this.GetIndex=function(e){return e=$this.Select(e),Array.prototype.slice.call(e.parentElement.children).indexOf(e)},this.AddEventListener=function(e,t,i){Lure.AddEventListenerGlobal(e,t,i,$this.Content,$this)},this.AddTutor=function(e){$this.MonsieurTutor=new MonsieurTutor($this.Select(e),$this.Content)},this._SortBy=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t.length<2)){console.log("sort by",e),t.sort(function(t,i){return t[e]<i[e]&&$this._Sorting[e].Sorted?1:t[e]>i[e]&&$this._Sorting[e].Sorted?-1:t[e]<i[e]&&!$this._Sorting[e].Sorted?-1:t[e]>i[e]&&!$this._Sorting[e].Sorted?1:0}),$this._Sorting[e].Sorted=!$this._Sorting[e].Sorted;for(var i in $this._Sorting)$this._Sorting.hasOwnProperty(i)&&"_sorter"!==i&&($this._Sorting[i].Target.classList.remove("mt-sorting-up"),$this._Sorting[i].Target.classList.remove("mt-sorting-down"),e!==i&&($this._Sorting[i].Sorted=!1));$this._Sorting[e].Target.classList.add($this._Sorting[e].Sorted?"mt-sorting-down":"mt-sorting-up"),$this.Refresh()}},this._FilterBy=function(){var e=performance.now(),t=0,i=$this._Filter._DataDefault.slice(0),n=function(e){$this._Filter.hasOwnProperty(e)&&$this._Filter[e].Filter&&""!==$this._Filter[e].Filter&&(i=i.filter(function(t){return t[e].toString().toLowerCase().indexOf($this._Filter[e].Filter)>-1}),t++)};for(var r in $this._Filter)n(r);console.log(i),0===t?($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,$this.Controller._Data)),$this.Controller.Refresh()):($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,i)),$this.Controller.PageSize=$this._PageSize,$this.Controller._PageCursor=0,$this.Controller._Rebuilder(i)),mr.PerformanceNow(e,"FilterBy")},Props.call(this);for(var k in GetSet)Object.defineProperty($this,k,Object.getOwnPropertyDescriptor(GetSet,k));if(Methods.call(this),this.Show=function(e){this.isActive=!0,this.Control&&this.Control.Active();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));if(duration<durationAni&&(duration=durationAni),duration++,"Untyped"===$this.Type||$this.isVisible||Lure.ContentList[$this.Type].forEach(function(e){e!==$this&&e.isActive&&e.Hide()}),Dialog){if(Lure._DialogCount++,$this.Content.classList.add("lure-dialog"),DialogWrapper){$this.DialogWrapper=Lure.CreateElementFromString('<div class="dialog-wrapper">'),document.body.appendChild($this.DialogWrapper),$this.DialogWrapper.onclick=$this.Hide.bind($this);var zIndexWrapper=parseInt(window.getComputedStyle($this.DialogWrapper).zIndex),zIndexContent=parseInt(window.getComputedStyle($this.Content).zIndex);(Number.isNaN(zIndexContent)||zIndexContent<zIndexWrapper)&&($this.Content.style.zIndex=zIndexWrapper+1)}DialogBlur&&($this.DialogWrapper.style.background="none",Lure.Select(DialogBlur).classList.add("lure-blur")),DialogAnimation&&$this.Content.classList.add(DialogAnimation)}BeforeShow.call($this,e),Shower.call($this,e),$this.Content.style.display="",clearTimeout($this.__private.ToggleTimer),null!==Show&&($this.__private.ToggleTimer=setTimeout(function(){Show.call($this,e)},duration))},this.Hide=function(e){this.isActive=!1,this.Control&&this.Control.Disactive();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));duration<durationAni&&(duration=durationAni),duration++,Dialog&&(Lure._DialogCount--,$this.DialogWrapper&&$this.DialogWrapper.remove(),DialogBlur&&Lure._DialogCount<1&&Lure.Select(DialogBlur).classList.remove("lure-blur")),Hider.call($this,e),clearTimeout($this.__private.ToggleTimer),null!==Hide&&($this.__private.ToggleTimer=setTimeout(function(){Hide.call($this,e)},duration))},this.Toggle=function(e){$this.isVisible?$this.Hide(e):$this.Show(e)},this.__private={},this.__private.ToggleTimer=null,this.Control=new Lure.Plugin.Content.Control(Control,$this),this.Content.onclick=OnClick?OnClick.bind($this):null,Array.isArray(SubContent))for(var i=0;i<SubContent.length;i++)SubContent[i].Parent||(SubContent[i].Parent=$this),$this[SubContent[i].Name]=new Lure.Content(SubContent[i]);else for(var cname in SubContent)SubContent[cname].Parent=$this,SubContent[cname].Name=cname,$this[cname]=new Lure.Content(SubContent[cname]);if(this.TitleContent=Lure.Select(Title,this.Content),"Untyped"!==Type||Visible===!1||Dialog?("Untyped"!==Type&&Visible!==!0||Dialog&&Visible!==!0)&&(Visible=!1):Visible=!0,Visible?(this.Content.style.display="",this.Control&&this.Control.Active()):(this.isActive=!1,this.Content.style.display="none"),Controller&&(Controller.isController?(this.Controller=Controller,this.Controller.Parent=this):(Controller.Target||(Controller.Target=this.Content),Controller.Type||(Controller.Type="Templator"),Controller.Parent=this,this.Controller=new Lure.Plugin.Content.Controller[Controller.Type](Controller)),this.Controller.isHasEditable&&Lure._EditablesEventListenerRun($this.Content)),Sorting){$this._Sorting={},$this._Sorting._sorter=null;var _loop2=function(e){Sorting.hasOwnProperty(e)&&"_sorter"!==e&&($this._Sorting[e]={Target:$this.Select(Sorting[e]),Sorted:!1},$this._Sorting[e].Target.classList.add("mt-sorting"),$this._Sorting[e].Target.addEventListener("click",function(){$this._Sorting._sorter=e,$this._SortBy(e,$this.Controller._Data)}))};for(var f in Sorting)_loop2(f);console.info("mt-sortable",$this._Sorting)}if(Filtering){$this._Filter={},$this._Filter._DataDefault=$this.Controller._Data.slice(0);var _loop3=function(e){Filtering.hasOwnProperty(e)&&"_format"!==e&&($this._Filter[e]={Target:$this.Select(Filtering[e]),Filter:""},$this._Filter[e].Target.classList.add("mt-filtering"),$this._Filter[e].Target.innerHTML='<input type="text" class="mt-filtering-input">',$this._Filter[e].Target.querySelector(".mt-filtering-input").addEventListener("keyup",function(t){$this._Filter[e].Filter=t.target.value.toLowerCase(),$this._FilterBy()}))};for(var f in Filtering)_loop3(f)}Lure.ContentList[$this.Type]||(Lure.ContentList[$this.Type]=[]),Lure.ContentList[$this.Type].push(this),Array.from(this.Content.children).forEach(function(e){e.classList.contains("close")&&(e.onclick=function(e){$this.Hide(e)})}),setTimeout(function(){AfterBuild.call($this)},1)}var _ref2$Target=_ref2.Target,Target=void 0===_ref2$Target?null:_ref2$Target,_ref2$Content=_ref2.Content,Content=void 0===_ref2$Content?null:_ref2$Content,_ref2$CSS=_ref2.CSS,CSS=void 0===_ref2$CSS?"":_ref2$CSS,_ref2$Name=_ref2.Name,Name=void 0===_ref2$Name?null:_ref2$Name,_ref2$Global=_ref2.Global,Global=void 0!==_ref2$Global&&_ref2$Global,_ref2$Title=_ref2.Title,Title=void 0===_ref2$Title?"":_ref2$Title,_ref2$Type=_ref2.Type,Type=void 0===_ref2$Type?"Untyped":_ref2$Type,_ref2$Visible=_ref2.Visible,Visible=void 0===_ref2$Visible?void 0:_ref2$Visible,_ref2$SubContent=_ref2.SubContent,SubContent=void 0===_ref2$SubContent?[]:_ref2$SubContent,_ref2$Dialog=_ref2.Dialog,Dialog=void 0!==_ref2$Dialog&&_ref2$Dialog,_ref2$DialogWrapper=_ref2.DialogWrapper,DialogWrapper=void 0===_ref2$DialogWrapper||_ref2$DialogWrapper,_ref2$DialogBlur=_ref2.DialogBlur,DialogBlur=void 0===_ref2$DialogBlur?null:_ref2$DialogBlur,_ref2$DialogAnimation=_ref2.DialogAnimation,DialogAnimation=void 0===_ref2$DialogAnimation?null:_ref2$DialogAnimation,_ref2$Show=_ref2.Show,Show=void 0===_ref2$Show?null:_ref2$Show,_ref2$Hide=_ref2.Hide,Hide=void 0===_ref2$Hide?null:_ref2$Hide,_ref2$Shower=_ref2.Shower,Shower=void 0===_ref2$Shower?function(){this.Content.style.display=""}:_ref2$Shower,_ref2$Hider=_ref2.Hider,Hider=void 0===_ref2$Hider?function(){this.Content.style.display="none"}:_ref2$Hider,_ref2$BeforeShow=_ref2.BeforeShow,BeforeShow=void 0===_ref2$BeforeShow?function(){}:_ref2$BeforeShow,_ref2$Refresh=_ref2.Refresh,Refresh=void 0===_ref2$Refresh?function(e,t){this.Controller&&this.Controller.Refresh(e,t)}:_ref2$Refresh,_ref2$Sorting=_ref2.Sorting,Sorting=void 0!==_ref2$Sorting&&_ref2$Sorting,_ref2$Filtering=_ref2.Filtering,Filtering=void 0!==_ref2$Filtering&&_ref2$Filtering,_ref2$OnClick=_ref2.OnClick,OnClick=void 0===_ref2$OnClick?null:_ref2$OnClick,_ref2$Controller=_ref2.Controller,Controller=void 0===_ref2$Controller?null:_ref2$Controller,_ref2$Control=_ref2.Control,Control=void 0===_ref2$Control?null:_ref2$Control,_ref2$Props=_ref2.Props,Props=void 0===_ref2$Props?function(){}:_ref2$Props,_ref2$Methods=_ref2.Methods,Methods=void 0===_ref2$Methods?function(){}:_ref2$Methods,_ref2$GetSet=_ref2.GetSet,GetSet=void 0===_ref2$GetSet?{}:_ref2$GetSet,_ref2$AfterBuild=_ref2.AfterBuild,AfterBuild=void 0===_ref2$AfterBuild?function(){}:_ref2$AfterBuild,_ref2$Disabled=_ref2.Disabled,Disabled=void 0!==_ref2$Disabled&&_ref2$Disabled,_ref2$Parent=_ref2.Parent,Parent=void 0===_ref2$Parent?null:_ref2$Parent;if(_classCallCheck(this,LureContent),!Disabled){var $this=this;if(this.isContent=!0,this.isActive=!0,this.Parent=Parent,null!==Parent?(this.Target=Global?Lure.Select(Target):Lure.Select(Target,this.Parent.Content),null===this.Target&&(this.Target=this.Parent.Content)):null!==Target&&(this.Target=Lure.Select(Target)),null===Content?(this.Content=this.Target,construct.call($this)):null===Content.match(/<[^>]+>/)?(console.log("get load"),Lure.GetFileText(Content).then(function(e){MakeContent.call($this,e),construct.call($this)})):(MakeContent.call($this,Content),construct.call($this)),null===this.Content||null===this.Target)return void(this.isContent=!1);if(""!==CSS){var node=document.createElement("style");node.innerHTML=CSS,document.body.appendChild(node)}}}return _createClass(LureContent,[{key:"RefreshOne",value:function(e){this.Controller&&this.Controller.RefreshOne(e)}},{key:"Remove",value:function(e,t){this.Controller&&this.Controller.Remove(e,t)}},{key:"Add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Controller&&this.Controller.Add(e,t,i,n)}},{key:"Edit",value:function(e,t){this.Controller&&this.Controller.Edit(e,t)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactive(),delete this.Controller,delete this.Control}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(e){this.TitleContent.innerHTML=e}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:null},set:function(e){this.Controller&&(this.Controller.Data=e)}},{key:"Items",get:function(){return this.Controller?this.Controller.Items:null}}]),LureContent}(),Control:function(){function e(t,i){var n=this;_classCallCheck(this,e),null!==t&&t.length>0&&!function(){for(var e=n,r=function(n){t[n].Name||(t[n].Name="unnamed_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),e[t[n].Name]={Content:Lure.SelectAll(t[n].Target),_Content:t[n].Target,Type:t[n].Type?t[n].Type:"Untyped",isGlobal:t[n].Global,OnClick:t[n].OnClick?t[n].OnClick:i.Show,OnChange:t[n].OnChange,Active:function(){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.add("active")})},Disactive:function(){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.remove("active")})}},e[t[n].Name].Content.forEach(function(e){e.classList.add("pointer")}),t[n].Global?Lure.AddEventListenerGlobal("click",t[n].Target,function(r){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.remove("active")}),r.target.classList.add("active"),e[t[n].Name].OnClick&&e[t[n].Name].OnClick.call(i,r)}):e[t[n].Name].Content.forEach(function(r){r.onclick=function(r){Lure.ContentList[i.Type].forEach(function(e){e!==i&&e.Control&&e.Control.Disactive()}),e[t[n].Name].Content.forEach(function(e){e.classList.remove("active")}),r.currentTarget.classList.add("active"),e[t[n].Name].OnClick.call(i,r)}}),t[n].OnChange&&(t[n].Global?Lure.AddEventListenerGlobal("change",t[n].Target,function(e){t[n].OnChange.call(i,e)}):e[t[n].Name].Content.forEach(function(e){e.onchange=function(e){t[n].OnChange.call(i,e)}}))},a=0;a<t.length;a++)r(a)}()}return _createClass(e,[{key:"Active",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var t in this)this[t].Type===e&&this[t].Content.forEach(function(e){e.classList.add("active")})}},{key:"Disactive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var t in this)this[t].Type===e&&(this[t].Content.forEach(function(e){e.classList.remove("active")}),this[t].isGlobal&&Lure.SelectAll(this[t]._Content).forEach(function(e){e.classList.remove("active")}))}}]),e}(),Controller:{Templator:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.Target,n=void 0===i?null:i,r=t.Data,a=void 0===r?[]:r,o=t.ListElement,l=void 0===o?".list_element":o,s=t.EmptyMessage,c=void 0===s?"":s,u=t.EmptyHide,d=void 0!==u&&u,h=t.PageSize,f=void 0===h?-1:h,p=t.DataCount,g=void 0===p?-1:p,v=t.PageGet,m=void 0===v?null:v,C=t.ShowAllButton,b=void 0===C||C,S=t.LineSave,_=void 0===S?function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};setTimeout(function(){n()},500)}:S,y=t.LineAdd,L=void 0===y?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};setTimeout(function(){t()},500)}:y,T=t.EditModeSwitch,$=void 0===T?null:T,D=(t.DataSaveAll,t.NoAnimation),E=void 0!==D&&D,A=t.NoBuild,k=void 0!==A&&A,x=t.BeforeBuild,w=void 0===x?function(){}:x,O=t.AfterBuild,P=void 0===O?function(){}:O,M=t.AfterAdd,B=void 0===M?function(){}:M,H=t.Parent,G=void 0===H?null:H;
_classCallCheck(this,e);var N=this;this.isController=!0,null!==G?this.Content=Lure.Select(n,G.Content):this.Content=Lure.Select(n),this.Target=this.Content,this._Data=a,this.EmptyMessage=c,this.ListElement="",this.BeforeBuild=w.bind(this),this.AfterBuild=P.bind(this),this.AfterAdd=B.bind(this),this.Parent=G,this.PageSize=f,this._PageSize=f,this._DataCount=g>0?g:this._Data.length,this._PageCursor=0,this._PageGet=m,this.LineAdd=L,this.LineSave=_,this.Type=null,this.isShowAllButton=b,this.isNoAnimaton=E,this.isEmptyHide=d;var I=[];this._Dictionary=I;var F=function(){N._Data||(N._Data={});for(var e=0;e<I.length;e++)for(var t=0;t<I[e].fields.length;t++){var i=I[e].fields[t].Target.indexOf("attributes")>-1,n=I[e].fields[t].BuildValue(N._Data);i?I[e].obj.attributes[I[e].fields[t].Target.split(".")[1]].value=n:I[e].obj[I[e].fields[t].Target]=I[e].fields[t].BuildValue(N._Data)}};this._Rebuilder=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N._Data,t="";0===N._PageCursor&&N.Content.querySelectorAll(".mt-line, .mt-paginator, .mt-empty").forEach(function(e){e.remove()});var i=void 0,n=e.length;if(N._DataCount=g>0?g:n,N.PageSize>0){N._DataCount=N._DataCount>0?N._DataCount:e.length;var r=N.Content.querySelector(".mt-paginator");null!==r&&r.remove(),n=parseInt(N._PageCursor)+parseInt(N.PageSize),n>N._DataCount&&N._DataCount>0&&(n=N._DataCount),i=N._DataCount-n,i>N.PageSize&&(i=N.PageSize)}if("ItemList"===N.Type&&0===e.length&&""!==N.EmptyMessage&&!N.isEmptyHide){var a=N.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),o=document.createElement(a);return o.classList.add("mt-empty"),o.innerHTML=N.EmptyMessage,void N.Content.appendChild(o)}if("ItemList"===N.Type&&0===e.length&&N.isEmptyHide)return void(N.Content.style.display="none");if(0!==e.length){for(var l=N._PageCursor;l<n;l++)t+=N._LineBuilder(e[l],l,e.length);if(N.Content.children.length<1?N.Content.innerHTML=t:(t=Lure.CreateElementsFromString(t,N.Content.tagName),null!==t&&t.forEach(function(e){N.Content.appendChild(e)})),N.PageSize>0&&(N._PageCursor=n),N.PageSize>0&&N._PageCursor<N._DataCount){var s=void 0,c="<span>  (Не загружено "+(N._DataCount-N._PageCursor)+") </span>";N.isShowAllButton&&(c='<span> или </span><span class="mt-btn-nextAll dotted pointer"> Все ( '+(N._DataCount-N._PageCursor)+" )</span>");var u="table"===N.Content.tagName||"thead"===N.Content.tagName||"tbody"===N.Content.tagName;if(u){var d=N.Content.querySelector("tr:first-child th").length+1;s='<tr class="mt-paginator"><td colspan="'+d+'" class="element block-head"><span class="tpltr-next dotted pointer">Показать еще '+i+"</span>"+c+"</td></tr>",s=Lure.CreateElementFromString(s,N.Content.tagName)}else s=Lure.CreateElementFromString("<div class='mt-paginator'><span class=\"mt-btn-next dotted pointer\">Показать еще "+i+"</span>"+c+"</div>");var h=s.querySelector(".mt-btn-next");h.onclick=function(){N._PageCursor>=e.length?N._PageGet(N._PageCursor,N.PageSize,W):R()};var f=s.querySelector(".mt-btn-nextAll");f.onclick=function(){N.PageSize=N._DataCount,null!==N._PageGet?N._PageGet(N._PageCursor,N._DataCount-N._PageCursor,W):R()},N.Content.appendChild(s)}}};var R=function(){N.BeforeBuild(),"Refresh"===N.Type?F():"ItemList"===N.Type&&N._Rebuilder(),N.AfterBuild()},W=function(e){for(var t=0;t<e.length;t++)N._Data.push(e[t]);R()};if(this.FieldAdd=function(e){for(var t=e.attributes,i=[],n=-1,r=0;r<t.length;r++)t[r].value.indexOf("{{")>-1&&("value"!==t[r].name?i.push({Target:"attributes."+t[r].name,BuildValue:Lure.Compile(t[r].value)}):i.push({Target:t[r].name,BuildValue:Lure.Compile(t[r].value)}),n=0);e.childNodes.length<2&&e.innerHTML.indexOf("{{")>-1&&(i.push({Target:"innerHTML",BuildValue:Lure.Compile(e.innerHTML)}),n=0!==n?1:2),n>-1&&I.push({obj:e,fields:i})},this.Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;N.PageSize=N._PageSize,N._PageCursor=0,null!==e&&(N._Data=e),N.PageCursor=0,null===t?R():N.RefreshOne(t)},this.RefreshOne=function(e){var t=Lure.CreateElementFromString(N._LineBuilder(N._Data[e],e,N._Data.length),N.Content.tagName),i=N.Items[e];N.Items[e].parentNode.replaceChild(t,i)},this.Add=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];0===N._Data.length&&null!==N.Content.querySelector(".mt-empty")&&N.Content.querySelector(".mt-empty").remove();var r=document.createDocumentFragment(),a=document.createElement(N.Content.tagName),o=void 0;if(i){for(o=0,N.Items.forEach(function(e){console.log(e),console.log(e.dataset.line),e.dataset.line=parseInt(e.dataset.line)+1}),a.innerHTML=N._LineBuilder(e,0,N._Data.length+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);t&&r.children[0].classList.add(t),n&&N._Data.unshift(e),N.Content.prepend(r)}else{for(o=N._Data.length,n||o--,a.innerHTML=N._LineBuilder(e,o,o+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);t&&r.children[0].classList.add(t),n&&N._Data.push(e),N.Content.appendChild(r)}null!==N.LineAdd&&N.LineAdd(e,function(){var e=N.Content.querySelector("."+t);e&&e.classList.remove(t)}),N.AfterAdd(e,o)},this.Edit=function(e,t){console.log("edit itemData",t,e),Array.from(N.Items).filter(function(e){return parseInt(e.dataset.line)===t})[0].classList.add("editable-waiting"),N.LineSave(t,"$this",e,function(){N._Data[t]=e,N.RefreshOne(t)})},this.Remove=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];N.Content.querySelector('.mt-line[data-line="'+e+'"]').remove();for(var i=e;i<N.Items.length;i++)N.Items[i].dataset.line=parseInt(N.Items[i].dataset.line)-1,N.Items[i].querySelectorAll("[data-line]").forEach(function(e){e.dataset.line=parseInt(e.dataset.line)-1});t&&N._Data.splice(e,1),0===N._Data.length&&N.Refresh()},this.SwitchToEditMode=function(){Lure.Editable.EditMode=!0,Lure.SelectAll(".editable",N.Content).forEach(function(e){Lure.Editable.AddEdits(e)})},Array.isArray(this._Data)){this.Type="ItemList";var j=null!==l.match(/^[a-zA-Z0-9.,\-_ *#]+$/g);if(j){var Y=this.Content.querySelector(l);Y.classList.add("mt-line"),l=Y.outerHTML,Y.remove()}else{var V=l.match(/<[^>]+>/)[0],q=void 0,z=V.indexOf('class="');z<0?q=V.substr(0,V.length-1)+' class="mt-line"'+V.substr(V.length-1):(z=V.indexOf('"',z+8),q=V.substr(0,z)+" mt-line"+V.substr(z)),l=l.replace(V,q)}l=l.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(t,' data-line="{{i}}">')}),this.ListElement=l,this._LineBuilder=Lure.Compile(l,!0),null!==l.match(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/)&&(this.isHasEditable=!0,null!==$&&Lure.Select($).addEventListener("change",function(e){e.currentTarget.checked?N.SwitchToEditMode():(Lure.Editable.EditMode=!1,document.body.click())})),this.Content.MonsieurController=this,this.Content.classList.add("mt-content")}else{this.Type="Refresh";var X=Array.prototype.slice.call(this.Content.querySelectorAll("*:not(g):not(path):not(clipPath):not(text):not(br)"));X.push(this.Content),X.forEach(function(e){N.FieldAdd(e)})}Lure.TemplatorList.push(this),k||R()}return _createClass(e,[{key:"Data",get:function(){return this._Data},set:function(e){this._Data=e}},{key:"Items",get:function(){return this.Content.querySelectorAll(".mt-line")}}]),e}(),TreeBuilder:function(){function e(t){var i=t.Target,n=void 0===i?null:i,r=t.Data,a=void 0===r?[]:r,o=t.ListElement,l=void 0===o?null:o,s=t.Drop,c=void 0!==s&&s,u=t.SubSelector,d=void 0===u?null:u,h=t.SubSelectorHandler,f=void 0===h?function(){}:h,p=t.BeforeBuild,g=void 0===p?function(){}:p,v=t.AfterBuild,m=void 0===v?function(){}:v,C=t.Parent,b=void 0===C?null:C;_classCallCheck(this,e),this.isController=!0,this.Content=Lure.Select(n),this.Target=this.Content,this.Parent=b,this._Data=a,this.SubSelector=d,this.SubSelectorHandler=f.bind(this),this.BeforeBuild=g.bind(this),this.AfterBuild=m.bind(this);var S=c?"mtb-sub_tree dropable":"mtb-sub_tree",_=0,y=null===l?this.Content.innerHTML:l;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",y=y.replace(/^([\s\S]*)(<\/\w+>)$/,function(e,t,i){return i='<div class="'+S+'"></div>'+i,t+i})),this.LineBuilder=Lure.Compile(y,!0);var L=this,T=0,$=function E(e,t,i){T++;var n={$lvl:_,$key:t,$index:T,$j:i},r=Lure.CreateElementFromString(L.LineBuilder(e,T,null,n));r.classList.add("mtb-branch");for(var a in e){var o=e[a];if(Array.isArray(o)){_++;for(var l=0;l<o.length;l++)if(null===L.SubSelector)r.appendChild(E(o[l],a,l));else{r.classList.add("mtb-has_tree"),c&&r.classList.add("dropable");var s=r.querySelector(L.SubSelector);s.appendChild(E(o[l],a,l))}_--}}return r},D=function(){if(L.BeforeBuild(),Array.isArray(L._Data)){L.Content.innerHTML="",_++;for(var e=0;e<L._Data.length;e++)L.Content.appendChild($(L._Data[e],"root",0));_--}else L.Content.appendChild($(L._Data,"root",0));_=0,T=0,L.AfterBuild()};D(this._Data),this.Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L._Data;L._Data=e,D()}}return _createClass(e,[{key:"Data",get:function(){return this._Data},set:function(e){this._Data=e}}]),e}()}},Lure.Content=Lure.Plugin.Content.Content,Lure.Plugin.Tutor=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e);var n=this;this.TargetButton=Lure.Select(t),this.TargetContent=Lure.Select(i);var r='<div class="lure-tutor">\n                        <div class="cd-caption">\n                            <span>Шаг </span>\n                            <span class="lure-tutor_step"></span>\n                        </div>\n                        <div class="lure-tutor_desc"></div>\n                        <div class="lure-tutor_btns">\n                            <button class="button btn-tutor btn-tutor-stop">Прервать обучение</button>\n                            <button class="button btn-tutor btn-tutor-next">Далeе →</button></div>\n                   </div>';this.Content=Lure.CreateElementFromString(r),this.ContentBG=Lure.CreateElementFromString('<div class="lure-tutor-bg dialog-wrapper"></div>'),this.Content.style.display="none",this.ContentBG.style.display="none",this._Description=this.Content.querySelector(".lure-tutor_desc"),this._Step=this.Content.querySelector(".lure-tutor_step"),this._ButtonNext=this.Content.querySelector(".btn-tutor-next"),this._ButtonStop=this.Content.querySelector(".btn-tutor-stop"),n.Data=[];var a=this._ButtonNext.innerHTML,o=0,l=document.createElement("div");l.style.display="none",document.body.appendChild(l);var s=window.getComputedStyle(l).backgroundColor;l.remove();var c=function(){var e=n.Data[o-1].obj;if("tr"!==e.tagName.toLowerCase())return e.style.zIndex="",e.style.position="",e.style.outline="",e.style.display="",void(e.style.backgroundColor="");var t=e.querySelectorAll("th, td");t.forEach(function(e){e.style.position="",e.style.zIndex=""})},u=function(e){if("tr"!==e.tagName.toLowerCase()){e.style.zIndex="11",e.style.position="relative",e.style.outline="5px #bee0ff solid";var t=window.getComputedStyle(e);return t.backgroundColor===s&&(e.style.backgroundColor="#fff"),void(Lure.isVisible(e)||("table"!==e.tagName.toLowerCase()?e.style.display="block":e.style.display="table"))}var i=e.querySelectorAll("th, td");i.forEach(function(e){e.style.zIndex="11",e.style.position="relative";var t=window.getComputedStyle(e);t.backgroundColor===s&&(e.style.backgroundColor="#fff")})},d=function(){if(console.log("tutor run"),null!==n.TargetContent){var e=n.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(e.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");e.forEach(function(e){n.Data.push({obj:e,desc:e.dataset.tutor})}),n.Content.style.display="",n.ContentBG.style.display="",h()}},h=function(){if(o>0&&c(),o===n.Data.length)return void f();var e=n.Data[o].obj,t=n.Data[o].desc,i=t.match(/{([\s\S]+)}/);null!==i&&(i=i[1],t=t.replace(/{([\s\S]+)}/,""),e=e.closest(i),n.Data[o].obj=e),u(e),n._Step.innerHTML=o+1+"/"+n.Data.length,n._Description.innerHTML=t,o+1===n.Data.length&&(n._ButtonNext.innerHTML="Завершить",n._ButtonStop.style.opacity="0");var r=e.offsetLeft+e.clientWidth+10,a=e.offsetTop-n.Content.clientHeight-10;a<10&&(a=10),r+n.Content.clientWidth>window.innerWidth&&(r=e.offsetLeft-n.Content.clientWidth-10,window.innerWidth<n.Content.clientWidth+e.clientWidth&&(r=e.offsetLeft+e.clientWidth-n.Content.clientWidth-20)),(document.documentElement.scrollTop>a||document.documentElement.scrollTop+window.innerHeight<e.offsetTop+e.offsetHeight)&&(document.documentElement.scrollTop=a-10+"px"),r<10&&(r=10),n.Content.style.left=r+"px",n.Content.style.top=a+"px",o++},f=function(){c(),n.Content.style.display="none",n.ContentBG.style.display="none",n._ButtonNext.innerHTML=a,n._ButtonStop.style.opacity="",o=0,n.Data=[]};this.TargetButton.onclick=d,this._ButtonNext.onclick=h,this._ButtonStop.onclick=f,document.body.appendChild(this.Content),document.body.appendChild(this.ContentBG),this.Run=d},Lure.Plugin.Load=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.Target,n=void 0===i?"body":i;_classCallCheck(this,e),this.Target=Lure.Select(n),this.Target.style.position="relative",this.Content=Lure.CreateElementFromString('<div class="ajax-loading" style="display: none"></div>');var r=60,a=60,o=function(e,t){for(var i=" M "+(r+e)+" "+a,n=0;n<t;n++){var o=n*(Math.PI/180),l=r+Math.cos(o)*e,s=a+Math.sin(o)*e;i+=" L "+l+" "+s}return i},l='<svg xmlns="http://www.w3.org/2000/svg">\n                     <path d="'+o(45,160)+'" class="lure-arc1" fill="none" stroke="#449b22" stroke-width="5"></path>\n                     <path d="'+o(40,130)+'" class="lure-arc2" fill="none" stroke="#61c8de" stroke-width="5"></path>\n                     <path d="'+o(35,100)+'" class="lure-arc3" fill="none" stroke="#761c19" stroke-width="5"></path>\n                     <path d="'+o(30,70)+'"  class="lure-arc4" fill="none" stroke="#333333" stroke-width="5"></path>\n                   </svg>';this.Target.appendChild(this.Content),this.Content.innerHTML=l,this.Timeout=null}return _createClass(e,[{key:"Show",value:function(){var e=this;this.Content.style.display="",clearTimeout(this.TimeoutHide),this.Timeout=setTimeout(function(){e.Content.style.display="block"},70)}},{key:"Hide",value:function(){var e=this;clearTimeout(this.Timeout),this.TimeoutHide=setTimeout(function(){e.Content.style.display="none"},250)}}]),e}(),Lure.Plugin.Tooltip=function t(e){var i=e.Target,n=void 0===i?document:i,r=e.Attribute,a=void 0===r?"data-tooltip":r,o=e.Delay,l=void 0===o?400:o,s=e.Time,c=void 0===s?1100:s,u=(e.Cursor,e.Custom),d=void 0===u?'<div class="lure-tooltip">':u,h=e.AfterBuild,f=void 0===h?function(){}:h;_classCallCheck(this,t);var p=this;this.ToolTip=Lure.CreateElementFromString(d);var g=null,v=null;this.Target=Lure.Select(n);var m=function(e){this.ToolTip.innerHTML=e,p.Target.appendChild(this.ToolTip)}.bind(this);Lure.AddEventListenerGlobal("mouseover","["+a+"]",function(e){var t=e.currentTarget.dataset[a.replace("data-","")];clearTimeout(v),g=setTimeout(function(){m(t)},l)},this.Target),Lure.AddEventListenerGlobal("mouseout","["+a+"]",function(e){clearTimeout(g),v=setTimeout(function(){},c)},this.Target),setTimeout(function(){f.bind(p)},0)},Lure.Tutor=Lure.Plugin.Tutor,Lure.Load=Lure.Plugin.Load,Lure.Tooltip=Lure.Plugin.Tooltip,Lure.Plugin.Chart={Core:"",Chart:function(){function e(){function t(){var e="",t="",i="",n="",r="",a=m.Options.Series.filter(function(e){return"pie"===e.Type}).length!==m.Options.Series.length;console.log("isGraph",a);var o=void 0;a&&(o=b.MakeGraph);for(var s=0;s<m.Options.Series.length;s++)e+=b.MakeLegend(m.Options.Series[s],s),t+=b.MakeAxisY(m._ScaleY.Scales[s],s,m.Options.Series[m._ScaleY.Dict[s]].Title?m.Options.Series[m._ScaleY.Dict[s]].Title:m.Options.Series[m._ScaleY.Dict[s]].Name,m.Options.Series[m._ScaleY.Dict[s]].Color),r+=o(m.Options.Series[s],s);e='<div class="mt-chart-legend row">'+e+"</div>",t='<div class="mt-chart-y row">'+t+"</div>",i=b.MakeAxisX(),n=b.MakeGrid(m.Options.Labels.Data.length,m._ScaleY.Scales[0].length-1),m.Content.innerHTML='<div class="mt-chart col">\n                        <div class="mt-chart-caption">\n                          <div class=\'mt-chart-title\'>'+l+'</div>\n                          <div class="mt-chart-legend row">'+e+'</div>\n                        </div>\n                        <div class="mt-chart-kek row flex-100">\n                          <div class="mt-chart-y row">'+t+'</div>\n                          <div class="col flex-100">\n                            <div class="mt-chart-area row flex-100">\n                              <svg class="mt-chart-svg">'+r+'</svg>\n                              <div class="mt-chart-grid" style=" position: absolute;">'+n+'</div>\n                            </div>\n                            <div class="mt-chart-x row">'+i+"</div>\n                           </div>\n                        </div>\n                      </div>"}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.Type,a=void 0===r?"Line":r,o=n.Title,l=void 0===o?"":o,s=n.Labels,c=void 0===s?{Rotation:"auto",Data:[]}:s,u=n.Series,d=void 0===u?[{Data:[],Type:"",OwnAxis:!1,Color:"#eee"},{Data:[],Type:"",OwnAxis:[0,100],Color:"#eee"}]:u,h=n.Tooltip,f=void 0===h?{Template:"Name: {{Name}}<br>Value: {{Value}}"}:h,p=n.AxisY,g=void 0===p?{Scale:["auto","auto","auto"],Visible:!0}:p;n.Height,n.SeriesOptions;_classCallCheck(this,e);var v=["red","green","cornflowerblue","purple","palevioletred","orange"],m=this;this.Content=Lure.Select(i),this.Content.classList.add("mt-chart"),this.Content.style.position="relative",this.isGraph=!0;var C={Legend:"",AxisX:"",AxisY:"",Grid:"",Svg:"",Height:0,Width:0,Abscissa:null,SeriesPoints:[],ParametersAxisX:null};this._Series=d,this.__InitSeries=function(){for(var e=[],t=0;t<this._Series.length;t++){var i={};i.Name=this._Series[t].Name?this._Series[t].Name:"Unnamed",i.Data=this._Series[t].Data,i.OwnAxis=this._Series[t].OwnAxis,i.Title=this._Series[t].Title?this._Series[t].Title:i.Name,i.Type=this._Series[t].Type?this._Series[t].Type.toLowerCase():a?a.toLowerCase():"line",i.Color=this._Series[t].Color?this._Series[t].Color:v[t]?v[t]:"#000",i.Width=this._Series[t].Width?this._Series[t].Width:2,i.Point=d[t].Point,i.Point=Lure.Chart.GetSeriePointOptions(i),C.Legend+=Lure.Chart.MakeLegend(i,t),e.push(i)}return e}.bind(this),this.Options={Title:l?l:"",Labels:{Visible:"undefined"==typeof c.Visible||c.Visible,Rotation:c.Rotation?c.Rotation:"auto",Data:c.Data?c.Data:[]},Series:this.__InitSeries(),SeriesOptions:{BarStack:!1,BarGradient:!0},AxisY:{Scale:g.Scale?[Lure.isNumeric(g.Scale[0])?g.Scale[0]:"auto",Lure.isNumeric(g.Scale[1])?g.Scale[1]:"auto",Lure.isNumeric(g.Scale[2])?g.Scale[2]:"auto"]:["auto","auto","auto"],Visible:"undefined"==typeof g.Visible||g.Visible},Tooltip:{Template:f.Template?f.Template:"Name: {{Name}}<br>Value: {{Value}}"}},this.Block=function(){this.Content.innerHTML='<div class="mt-chart col">\n                                        <div class="mt-chart-caption">\n                                          <div class=\'mt-chart-title\'>'+l+'</div>\n                                          <div class="mt-chart-legend row"></div>\n                                        </div>\n                                        <div class="mt-chart-kek row flex-100">\n                                          <div class="mt-chart-y row"></div>\n                                          <div class="col flex-100">\n                                            <div class="mt-chart-area row flex-100">\n                                              <svg class="mt-chart-svg"></svg>\n                                              <div class="mt-chart-grid" style=" position: absolute;"></div>\n                                            </div>\n                                            <div class="mt-chart-x row"></div>\n                                           </div>\n                                        </div>\n                                      </div>';var e=this.Content.querySelector(".mt-chart-legend"),t=this.Content.querySelector(".mt-chart-x"),i=this.Content.querySelector(".mt-chart-y"),n=this.Content.querySelector(".mt-chart-area"),r=this.Content.querySelector(".mt-chart-grid"),a=this.Content.querySelector(".mt-chart-svg");return{get Legend(){return e},set Legend(t){e.innerHTML=t},get AxisX(){return t},set AxisX(e){t.innerHTML=e},get AxisY(){return i},set AxisY(e){i.innerHTML=e},get ChartArea(){return n},set ChartArea(e){n.innerHTML=e},get Grid(){return r},set Grid(e){r.innerHTML=e},get Svg(){return a},set Svg(e){a.innerHTML=e}}}.bind(this)();var b={MakeLegend:function(e,t){return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" checked="checked" id="legcheck'+e.Name+t+'">\n                          <div class="mt-legend-icon" style="background-color: '+e.Color+'"></div>\n                          <label class="mt-legend-label" for="legcheck'+e.Name+t+'">'+e.Name+"</label>\n                        </div>"},MakeAxisY:function(){var e=0;if(!m.Options.AxisY.Visible&&(e=1,m._ScaleY.Scales.length<2))return"";var t="";for(e;e<m._ScaleY.Scales.length;e++){var i=m._ScaleY.Dict.indexOf(e),n=m._ScaleY.Scales[e],r="";e>0&&(r='<div class="mt-chart-axis-caption"><div style="transform: rotate(-90deg)">'+m.Options.Series[i].Title+"</div></div>");for(var a="",o=0;o<n.length;o++)a+='<div class="mt-chart-label mt-chart-label__y"><span>'+n[o]+"</span></div>";t+='<div class="mt-chart-axis__y row" '+(e>0?'style="color: '+m.Options.Series[i].Color+'; font-weight: bold;"':"")+' data-line="'+e+'">'+r+'<div class="mt-chart-labels col">'+a+"</div></div>"}return t},MakeAxisX:function(){if(!m.Options.Labels.Visible)return"";for(var e=m.Options.Labels.Data,t="transform: rotate("+C.ParametersAxisX.Angle+"deg); margin-top: "+C.ParametersAxisX.MarginTop+"px; width: "+C.ParametersAxisX.Width+"px; margin-left: "+C.ParametersAxisX.MarginLeft+"px;",i="",n=0;n<e.length;n++)i+='<div class="mt-chart-label mt-chart-label__x"><span style="'+t+'">'+e[n]+"</span></div>";return i},MakeGrid:function(e,t){return Lure.Chart.GetGrid(e,t)},MakeGraph:function(e,t){var i=m._ScaleY.Dict[t],n=m._ScaleY.Scales[i],r=m._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,m.Height),o=Lure.Chart.GetAbscissa(m.Options.Labels.Data,m.Width),l=Lure.Chart.GetPoints(o,a);return Lure.Chart.GetPath(l,m.Options.Series[t].Type,t,m.Options.Series[t].Color,m.Options.Series[t].Width)},CalcAxisX:function(){var e=Lure.CreateElementFromString('<div class="mt-chart-label mt-chart-label__x"><span>'+m.Options.Labels.Data[0]+"</span></div>"),t=Lure.GetInlineSize(e,getComputedStyle(e.querySelector("span")).fontSize),i=m.Width/m.Options.Labels.Data.length,n=t.height,r=t.width,a=void 0;if("auto"!==m.Options.Labels.Rotation)a=parseFloat(m.Options.Labels.Rotation);else{var o=(i-n)/(r+n);o<.1&&(o=0),o>1&&(o=1),a=-90*(1-o)}return{Height:Math.round(n/4+Math.sqrt(Math.pow(r,2)-Math.pow(i,2))),Width:r,MarginTop:r>i?Math.sqrt(Math.pow(r,2)-Math.pow(i,2))-n:0,MarginLeft:r>i?-i/2:-r/2,Angle:a}}};this.__GetPath=function(e,t){switch(e.Type){case"line":return this.__GetPathLine(e,t);case"bar":return this.__GetPathBar(e,t);case"pie":return""}}.bind(this),this.__GetPathLine=function(e,t){C.Abscissa&&C.Width===this.Width||(C.Abscissa=Lure.Chart.GetAbscissa(m.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[t],n=this._ScaleY.Scales[i],r=m._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,m.Height),o=Lure.Chart.GetPoints(C.Abscissa,a);C.SeriesPoints[t]=o;for(var l=o.length,s=[],c=[],u=[],d=[],h=[],f=[],p=0;p<l;p++)s[p]=o[p][0],c[p]=o[p][1];for(var g=0;g<l-1;g++)u[g]=c[g+1]-c[g],d[g]=s[g+1]-s[g],h[g]=u[g]/d[g];f[0]=h[0],f[l-1]=h[l-2];for(var v=1;v<l-1;v++)0===h[v]||0===h[v-1]||h[v-1]>0!=h[v]>0?f[v]=0:(f[v]=3*(d[v-1]+d[v])/((2*d[v]+d[v-1])/h[v-1]+(d[v]+2*d[v-1])/h[v]),isFinite(f[v])||(f[v]=0));for(var b="M "+s[0]+","+c[0],S='<g class="mt-chart-dots">',_=0;_<l-1;_++)b+=" C "+(s[_]+d[_]/3)+","+(c[_]+f[_]*d[_]/3)+" "+(s[_+1]-d[_]/3)+","+(c[_+1]-f[_+1]*d[_]/3)+" "+s[_+1]+","+c[_+1],e.Point.Visible&&(S+=Lure.Chart.GetPathLineDot(s[_],c[_],t,_,e.Color,e.Point.Radius));return e.Point.Visible&&(S+=Lure.Chart.GetPathLineDot(s[l-1],c[l-1],t,l-1,e.Color,e.Point.Radius)),S+="</g>",'<g class="mt-chart-serie"><path data-line="'+t+'" d="'+b+'" fill="none" stroke="'+e.Color+'" stroke-width="'+e.Width+'"></path> '+S+"</g>"}.bind(this),this.__GetPathBar=function(e,t){C.Abscissa&&C.Width===this.Width||(C.Abscissa=Lure.Chart.GetAbscissa(m.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[t],n=this._ScaleY.Scales[i],r=m._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,m.Height),o=Lure.Chart.GetPoints(C.Abscissa,a);C.SeriesPoints[t]=o;var l=this.Height,s=e.Width,c='<g class="mt-chart-serie" data-type="Bar">',u="";this.Options.SeriesOptions.BarGradient&&(u="bar_"+Math.random().toString(36).replace("0.",""),c+='<linearGradient id="'+u+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var d="",h=0;h<o.length;h++){var f="M "+(o[h][0]-s/2)+" "+l+" L "+(o[h][0]+s/2)+" "+l+" "+(o[h][0]+s/2)+" "+o[h][1]+" "+(o[h][0]-s/2)+" "+o[h][1]+"Z";c+='<path class="mt-chart-tooltipable" data-line="'+t+'" data-item="'+h+'" d="'+f+'" fill="'+e.Color+'" stroke="#000" stroke-width="0"></path>',this.Options.SeriesOptions.BarGradient&&(c+='<path class="mt-chart-tooltipable"  data-line="'+t+'" data-item="'+h+'" d="'+f+'" fill="url(#'+u+')" ></path>')}return c+=d+"</g>"}.bind(this),function(){this.Block.Legend=C.Legend,C.ParametersAxisX=b.CalcAxisX(),console.log("this.Height-Buffer.ParametersAxisX.Height",this.Height,C.ParametersAxisX.Height),this._ScaleY=Lure.Chart.GetScaleY(this.Options.Series,this.Height-C.ParametersAxisX.Height,this),this.Block.AxisX=b.MakeAxisX(),this.Block.Grid=Lure.Chart.GetGrid(this.Options.Labels.Data.length,this._ScaleY.Scales[0].length-1);var e=this.isGraph;console.log("isGraph",e);var t=void 0;e&&(t=b.MakeGraph);var i="",n="",r="";i=b.MakeAxisY(),this.Block.AxisY=i;for(var a=0;a<m.Options.Series.length;a++)switch(m.Options.Series[a].Type){case"line":r+=this.__GetPathLine(m.Options.Series[a],a);break;case"bar":n+=this.__GetPathBar(m.Options.Series[a],a)}this.Block.Svg=n+r,this.Block.AxisY.style.height=this.Height+"px"}.bind(this)(),this.Tooltip=new Lure.Content({Name:"Tooltipchek",Target:this.Block.ChartArea,Content:'<div class="mt-chart-tooltip">\n                        <div class="val">'+this.Options.Tooltip.Template+"</div>\n                      </div>",Visible:!1,Controller:{Data:{}},BeforeShow:function(e,t){},Prop:function(){this._Timer=null,this._Timer2=null},Shower:function(){clearTimeout(this._Timer),clearTimeout(this._Timer2),this.Content.style.display="",this.Content.style.opacity="1"},Hider:function(){clearTimeout(this._Timer),this._Timer=setTimeout(function(){this.Content.style.opacity="0",this._Timer2=setTimeout(function(){this.Content.style.display="none"}.bind(this),200)}.bind(this),500)},Show:function(e){clearTimeout(this._Timer),this.Data.Name=e.data[0],this.Data.Value=e.data[1],this.Refresh(),this.Content.style.left=e.pos[0]+7+"px",this.Content.style.top=e.pos[1]-this.Content.clientHeight-7+"px",this.Content.style.backgroundColor=e.color},Methods:function(){this.Do=function(e){var t=e.currentTarget.tagName.toLowerCase();switch(t){case"circle":this.DoCircle(e);break;case"path":this.DoBar(e)}}.bind(this),this.DoCircle=function(e){var t=e.currentTarget,i=parseInt(t.dataset.line),n=parseInt(t.dataset.item),r=t.attributes.stroke.value,a=parseInt(t.attributes["stroke-width"].value);t.attributes.fill.value=r,t.attributes.r.value=parseInt(t.attributes.r.value)+a,t.attributes.stroke.value="#fff";var o={data:[d[i].Name,d[i].Data[n]],color:r,pos:C.SeriesPoints[i][n]};this.Show(o)}.bind(this),this.DoBar=function(e){var t=e.currentTarget,i=parseInt(t.dataset.line),n=parseInt(t.dataset.item),r={data:[m.Options.Series[i].Name,m.Options.Series[i].Data[n]],color:m.Options.Series[i].Color,pos:C.SeriesPoints[i][n]};this.Show(r)}.bind(this)},AfterBuild:function(){}}),Lure.AddEventListenerGlobal("mouseover",".mt-chart-point, .mt-chart-tooltipable",function(e){this.Tooltip.Do(e)},this.Content,this),Lure.AddEventListenerGlobal("mouseout",".mt-chart-point",function(e){var t=e.currentTarget,i=parseInt(t.attributes["stroke-width"].value);t.attributes.stroke.value=t.attributes.fill.value,t.attributes.fill.value="#fff",t.attributes.r.value-=i,m.Tooltip.Hide()},this.Content);(function(){for(var e=[],t=0;t<d.length;t++){var i=this._ScaleY.Dict[t],n=this._ScaleY.Scales[i],r=this._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(d[t].Data,n,r,this.Block.Svg.Height);this._Abscissa=Lure.Chart.GetAbscissa(c.Data,this.Block.Svg.Width);var o=Lure.Chart.GetPoints(this._Abscissa,a);e[t]={h:this.Block.Svg.Height,Name:m.Options.Series[t].Name,Data:m.Options.Series[t].Data,DataPoints:o,Color:m.Options.Series[t].Color,Path:Lure.Chart.GetPath(o,m.Options.Series[t].Type,t,m.Options.Series[t].Color,m.Options.Series[t].Width),Width:m.Options.Width,options:{pointSize:d[t].Width?4+d[t].Width/4:4}}}return m.SuperData=e,e}).bind(this);this.TestB=function(){var e=performance.now();t(),Lure.Perf(e,"builder")},this.Refresh=function(){}.bind(this),this.Refresh(),setTimeout(function(){}.bind(this),0),this.Buffer=C}return _createClass(e,[{key:"Height",get:function(){return this.Block.Svg.clientHeight}},{key:"Width",get:function(){return this.Block.Svg.clientWidth}}],[{key:"GetSeriePointOptions",value:function(e,t){var i=e.Point?e.Point:{};return i.Visible="undefined"==typeof i.Visible||i.Visible,i.Radius=i.Radius?i.Radius:4+e.Width/4,Number.isNaN(i.Radius),i}},{key:"GetScaleY",value:function(e,t,i){if("pie"===i.Type)return[];var n=e[0].Data[0],r=e[0].Data[0],a=!0,o=!0;"auto"!==i.Options.AxisY.Scale[0]&&"auto"!==i.Options.AxisY.Scale[1]&&(a=!1,n=i.Options.AxisY.Scale[0],r=i.Options.AxisY.Scale[1]),"auto"!==i.Options.AxisY.Scale[2]&&(o=!1);for(var l=[[e[0].Data[0],e[0].Data[0]]],s=0,c={Scales:[],Dict:[],MinMax:null},u=0;u<e.length;u++){c.Dict[u]=0,e[u].OwnAxis&&(s++,"undefined"!=typeof e[u].OwnAxis[0]?l.push(e[u].OwnAxis):l.push([e[u].Data[0],e[u].Data[0]]),c.Dict[u]=s);for(var d=0;d<e[u].Data.length;d++)a&&(e[u].Data[d]<n&&(n=e[u].Data[d]),e[u].Data[d]>r&&(r=e[u].Data[d])),e[u].OwnAxis&&"undefined"==typeof e[u].OwnAxis[0]&&(e[u].Data[d]<l[s][0]&&(l[s][0]=e[u].Data[d]),e[u].Data[d]>l[s][1]&&(l[s][1]=e[u].Data[d]))}l[0]=[n,r],c.MinMax=l;for(var h=0;h<l.length;h++){var f=l[h][1].toString().length,p=void 0;p=0!==h||o?l[h][2]?l[h][2]:(40*(l[h][1]-l[h][0])/t/Math.pow(10,f-1)/5).toFixed(1)*Math.pow(10,f-1)*5:i.Options.AxisY.Scale[2];for(var g=l[h][0],v=[];g<=l[h][1];)v.push(g),g+=p;v.push(g),c.Scales.push(v)}return c}},{key:"GetAbscissa",value:function(e,t){var i=t/e.length;return e.map(function(e,t){return t*i})}},{key:"GetOrdinata",value:function(e,t,i,n){for(var r=i[0],a=i[1],o=t[t.length-1]/a,l=[],s=0;s<e.length;s++)l.push(n-(e[s]-r)*n/(a-r)/o);return l}},{key:"GetPoints",value:function(e,t){for(var i=[],n=0;n<t.length;n++)i.push([e[n],t[n]]);return i}},{key:"GetPath",value:function(e,t,i,n,r){switch(t){case"line":return Lure.Chart.GetPathLine(e,i,n,r);case"bar":return Lure.Chart.GetPathBar(e,i,n,r);case"pie":return""}}},{key:"GetPathLine",value:function(e,t,i,n){for(var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=e.length,o=[],l=[],s=[],c=[],u=[],d=[],h=0;h<a;h++)o[h]=e[h][0],l[h]=e[h][1];for(var f=0;f<a-1;f++)s[f]=l[f+1]-l[f],c[f]=o[f+1]-o[f],u[f]=s[f]/c[f];d[0]=u[0],d[a-1]=u[a-2];for(var p=1;p<a-1;p++)0===u[p]||0===u[p-1]||u[p-1]>0!=u[p]>0?d[p]=0:(d[p]=3*(c[p-1]+c[p])/((2*c[p]+c[p-1])/u[p-1]+(c[p]+2*c[p-1])/u[p]),
isFinite(d[p])||(d[p]=0));for(var g="M "+o[0]+","+l[0],v='<g class="mt-chart-dots">',m=0;m<a-1;m++)g+=" C "+(o[m]+c[m]/3)+","+(l[m]+d[m]*c[m]/3)+" "+(o[m+1]-c[m]/3)+","+(l[m+1]-d[m+1]*c[m]/3)+" "+o[m+1]+","+l[m+1],r&&(v+=Lure.Chart.GetPathLineDot(o[m],l[m],t,m,i,n));return v+="</g>",'<g class="mt-chart-serie"><path data-line="'+t+'" d="'+g+'" fill="none" stroke="'+i+'" stroke-width="'+n+'"></path> '+v+"</g>"}},{key:"GetPathLineDot",value:function(e,t,i,n,r,a){return'<circle class="mt-chart-point" data-line="'+i+'" data-item="'+n+'" cx="'+e+'" cy="'+t+'" r="'+a+'" stroke="'+r+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"GetPathBar",value:function(e,t,i,n){console.log("GetPathBar",e);for(var r="",a=0;a<e.length;a++){"M "+e[a][0]+" "+e[a][1]+" L "+e[a][0]+" "+e[a][1];r+=Lure.Chart.GetPathLineDot(e[a][0],e[a][1],t,a,i,n)}return r}},{key:"MakeLegend",value:function(e,t){return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" checked="checked" id="legcheck'+e.Name+t+'">\n                          <div class="mt-legend-icon" style="background-color: '+e.Color+'"></div>\n                          <label class="mt-legend-label" for="legcheck'+e.Name+t+'">'+e.Name+"</label>\n                        </div>"}},{key:"GetGrid",value:function(e,t){for(var i="",n=0;n<t;n++){i+='<div class="mt-chart__grid-line row flex-100 flex-between">';for(var r=0;r<e;r++)i+="<div class='mt-chart__grid-item flex-100'></div>";i+="</div>"}return i+=""}}]),e}()},Lure.Chart=Lure.Plugin.Chart.Chart,Lure.__GenegateString=function(){var e=Math.random().toString(36).replace("0.","").replace(/[\d]+/,"").substring(0,1);return Lure.Select("#"+e)&&(e=Lure.__GenegateString()),e};
//# sourceMappingURL=lure.all.min.js.map
