"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Lure.Plugin.Content={Version:"0.9.1",Content:function(){function LureContent(_ref){function MakeContent(t){null===Controller||Array.isArray(Controller.Data)?this.Content=Lure.CreateElementFromString(t):null===Controller||Array.isArray(Controller.Data)||(t=t.replace(/>[^>]*({{[^#}]+}})[^>]*</g,function(t,e){var n=t.replace(/{{[^#}]+}}/g,function(t){return"<span>"+t+"</span>"});return n}),this.Content=Lure.CreateElementFromString(t)),this.Target.appendChild(this.Content)}function construct(){this.Type=Type,this.Name=Name,this.AllContents=Lure.ContentList,this.Refresh=Refresh.bind(this),this.Select=function(t){return Lure.Select(t,$this.Content)},this.SelectAll=function(t){return Lure.SelectAll(t,$this.Content)},this.GetParent=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=$this;null!==e.Parent&&e.Name!==t;)e=e.Parent;return e},this.GetContent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=this.GetParent(t);if(e.Name===t)return e;var n=e;if("root"===t)return n;var i=function r(e){for(var i in e)if("Parent"!==i&&e[i]&&e[i].isContent){if(e[i].Name===t)return e[i];n=r(e[i])}return n};return i(n)},this.GetIndex=function(t){return t=$this.Select(t),Array.prototype.slice.call(t.parentElement.children).indexOf(t)},this.AddEventListener=function(t,e,n){Lure.AddEventListenerGlobal(t,e,n,$this.Content,$this)},this.AddTutor=function(t){$this.MonsieurTutor=new MonsieurTutor($this.Select(t),$this.Content)},this._SortBy=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(e.length<2)){console.log("sort by",t),e.sort(function(e,n){return e[t]<n[t]&&$this._Sorting[t].Sorted?1:e[t]>n[t]&&$this._Sorting[t].Sorted?-1:e[t]<n[t]&&!$this._Sorting[t].Sorted?-1:e[t]>n[t]&&!$this._Sorting[t].Sorted?1:0}),$this._Sorting[t].Sorted=!$this._Sorting[t].Sorted;for(var n in $this._Sorting)$this._Sorting.hasOwnProperty(n)&&"_sorter"!==n&&($this._Sorting[n].Target.classList.remove("mt-sorting-up"),$this._Sorting[n].Target.classList.remove("mt-sorting-down"),t!==n&&($this._Sorting[n].Sorted=!1));$this._Sorting[t].Target.classList.add($this._Sorting[t].Sorted?"mt-sorting-down":"mt-sorting-up"),$this.Refresh()}},this._FilterBy=function(){var t=performance.now(),e=0,n=$this._Filter._DataDefault.slice(0),i=function(t){$this._Filter.hasOwnProperty(t)&&$this._Filter[t].Filter&&""!==$this._Filter[t].Filter&&(n=n.filter(function(e){return e[t].toString().toLowerCase().indexOf($this._Filter[t].Filter)>-1}),e++)};for(var r in $this._Filter)i(r);console.log(n),0===e?($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,$this.Controller._Data)),$this.Controller.Refresh()):($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,n)),$this.Controller.PageSize=$this._PageSize,$this.Controller._PageCursor=0,$this.Controller._Rebuilder(n)),mr.PerformanceNow(t,"FilterBy")},Props.call(this);for(var k in GetSet)Object.defineProperty($this,k,Object.getOwnPropertyDescriptor(GetSet,k));if(Methods.call(this),this.Show=function(e){this.isActive=!0,this.Control&&this.Control.Active();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));if(duration<durationAni&&(duration=durationAni),duration++,"Untyped"===$this.Type||$this.isVisible||Lure.ContentList[$this.Type].forEach(function(t){t!==$this&&t.isActive&&t.Hide()}),Dialog){if(Lure._DialogCount++,$this.Content.classList.add("lure-dialog"),DialogWrapper){$this.DialogWrapper=Lure.CreateElementFromString('<div class="dialog-wrapper">'),document.body.appendChild($this.DialogWrapper),$this.DialogWrapper.onclick=$this.Hide.bind($this);var zIndexWrapper=parseInt(window.getComputedStyle($this.DialogWrapper).zIndex),zIndexContent=parseInt(window.getComputedStyle($this.Content).zIndex);(Number.isNaN(zIndexContent)||zIndexContent<zIndexWrapper)&&($this.Content.style.zIndex=zIndexWrapper+1)}DialogBlur&&($this.DialogWrapper.style.background="none",Lure.Select(DialogBlur).classList.add("lure-blur")),DialogAnimation&&$this.Content.classList.add(DialogAnimation)}BeforeShow.call($this,e),Shower.call($this,e),$this.Content.style.display="",clearTimeout($this.__private.ToggleTimer),null!==Show&&($this.__private.ToggleTimer=setTimeout(function(){Show.call($this,e)},duration))},this.Hide=function(e){this.isActive=!1,this.Control&&this.Control.Disactive();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));duration<durationAni&&(duration=durationAni),duration++,Dialog&&(Lure._DialogCount--,$this.DialogWrapper&&$this.DialogWrapper.remove(),DialogBlur&&Lure._DialogCount<1&&Lure.Select(DialogBlur).classList.remove("lure-blur")),Hider.call($this,e),clearTimeout($this.__private.ToggleTimer),null!==Hide&&($this.__private.ToggleTimer=setTimeout(function(){Hide.call($this,e)},duration))},this.Toggle=function(t){$this.isVisible?$this.Hide(t):$this.Show(t)},this.__private={},this.__private.ToggleTimer=null,this.Control=new Lure.Plugin.Content.Control(Control,$this),this.Content.onclick=OnClick?OnClick.bind($this):null,Array.isArray(SubContent))for(var i=0;i<SubContent.length;i++)SubContent[i].Parent||(SubContent[i].Parent=$this),$this[SubContent[i].Name]=new Lure.Content(SubContent[i]);else for(var cname in SubContent)SubContent[cname].Parent=$this,SubContent[cname].Name=cname,$this[cname]=new Lure.Content(SubContent[cname]);if(this.TitleContent=Lure.Select(Title,this.Content),"Untyped"!==Type||Visible===!1||Dialog?("Untyped"!==Type&&Visible!==!0||Dialog&&Visible!==!0)&&(Visible=!1):Visible=!0,Visible?(this.Content.style.display="",this.Control&&this.Control.Active()):(this.isActive=!1,this.Content.style.display="none"),Controller&&(Controller.isController?(this.Controller=Controller,this.Controller.Parent=this):(Controller.Target||(Controller.Target=this.Content),Controller.Type||(Controller.Type="Templator"),Controller.Parent=this,this.Controller=new Lure.Plugin.Content.Controller[Controller.Type](Controller)),this.Controller.isHasEditable&&Lure._EditablesEventListenerRun($this.Content)),Sorting){$this._Sorting={},$this._Sorting._sorter=null;var _loop2=function(t){Sorting.hasOwnProperty(t)&&"_sorter"!==t&&($this._Sorting[t]={Target:$this.Select(Sorting[t]),Sorted:!1},$this._Sorting[t].Target.classList.add("mt-sorting"),$this._Sorting[t].Target.addEventListener("click",function(){$this._Sorting._sorter=t,$this._SortBy(t,$this.Controller._Data)}))};for(var f in Sorting)_loop2(f);console.info("mt-sortable",$this._Sorting)}if(Filtering){$this._Filter={},$this._Filter._DataDefault=$this.Controller._Data.slice(0);var _loop3=function(t){Filtering.hasOwnProperty(t)&&"_format"!==t&&($this._Filter[t]={Target:$this.Select(Filtering[t]),Filter:""},$this._Filter[t].Target.classList.add("mt-filtering"),$this._Filter[t].Target.innerHTML='<input type="text" class="mt-filtering-input">',$this._Filter[t].Target.querySelector(".mt-filtering-input").addEventListener("keyup",function(e){$this._Filter[t].Filter=e.target.value.toLowerCase(),$this._FilterBy()}))};for(var f in Filtering)_loop3(f)}Lure.ContentList[$this.Type]||(Lure.ContentList[$this.Type]=[]),Lure.ContentList[$this.Type].push(this),Array.from(this.Content.children).forEach(function(t){t.classList.contains("close")&&(t.onclick=function(t){$this.Hide(t)})}),setTimeout(function(){AfterBuild.call($this)},1)}var _ref$Target=_ref.Target,Target=void 0===_ref$Target?null:_ref$Target,_ref$Content=_ref.Content,Content=void 0===_ref$Content?null:_ref$Content,_ref$CSS=_ref.CSS,CSS=void 0===_ref$CSS?"":_ref$CSS,_ref$Name=_ref.Name,Name=void 0===_ref$Name?null:_ref$Name,_ref$Global=_ref.Global,Global=void 0!==_ref$Global&&_ref$Global,_ref$Title=_ref.Title,Title=void 0===_ref$Title?"":_ref$Title,_ref$Type=_ref.Type,Type=void 0===_ref$Type?"Untyped":_ref$Type,_ref$Visible=_ref.Visible,Visible=void 0===_ref$Visible?void 0:_ref$Visible,_ref$SubContent=_ref.SubContent,SubContent=void 0===_ref$SubContent?[]:_ref$SubContent,_ref$Dialog=_ref.Dialog,Dialog=void 0!==_ref$Dialog&&_ref$Dialog,_ref$DialogWrapper=_ref.DialogWrapper,DialogWrapper=void 0===_ref$DialogWrapper||_ref$DialogWrapper,_ref$DialogBlur=_ref.DialogBlur,DialogBlur=void 0===_ref$DialogBlur?null:_ref$DialogBlur,_ref$DialogAnimation=_ref.DialogAnimation,DialogAnimation=void 0===_ref$DialogAnimation?null:_ref$DialogAnimation,_ref$Show=_ref.Show,Show=void 0===_ref$Show?null:_ref$Show,_ref$Hide=_ref.Hide,Hide=void 0===_ref$Hide?null:_ref$Hide,_ref$Shower=_ref.Shower,Shower=void 0===_ref$Shower?function(){this.Content.style.display=""}:_ref$Shower,_ref$Hider=_ref.Hider,Hider=void 0===_ref$Hider?function(){this.Content.style.display="none"}:_ref$Hider,_ref$BeforeShow=_ref.BeforeShow,BeforeShow=void 0===_ref$BeforeShow?function(){}:_ref$BeforeShow,_ref$Refresh=_ref.Refresh,Refresh=void 0===_ref$Refresh?function(t,e){this.Controller&&this.Controller.Refresh(t,e)}:_ref$Refresh,_ref$Sorting=_ref.Sorting,Sorting=void 0!==_ref$Sorting&&_ref$Sorting,_ref$Filtering=_ref.Filtering,Filtering=void 0!==_ref$Filtering&&_ref$Filtering,_ref$OnClick=_ref.OnClick,OnClick=void 0===_ref$OnClick?null:_ref$OnClick,_ref$Controller=_ref.Controller,Controller=void 0===_ref$Controller?null:_ref$Controller,_ref$Control=_ref.Control,Control=void 0===_ref$Control?null:_ref$Control,_ref$Props=_ref.Props,Props=void 0===_ref$Props?function(){}:_ref$Props,_ref$Methods=_ref.Methods,Methods=void 0===_ref$Methods?function(){}:_ref$Methods,_ref$GetSet=_ref.GetSet,GetSet=void 0===_ref$GetSet?{}:_ref$GetSet,_ref$AfterBuild=_ref.AfterBuild,AfterBuild=void 0===_ref$AfterBuild?function(){}:_ref$AfterBuild,_ref$Disabled=_ref.Disabled,Disabled=void 0!==_ref$Disabled&&_ref$Disabled,_ref$Parent=_ref.Parent,Parent=void 0===_ref$Parent?null:_ref$Parent;if(_classCallCheck(this,LureContent),!Disabled){var $this=this;if(this.isContent=!0,this.isActive=!0,this.Parent=Parent,null!==Parent?(this.Target=Global?Lure.Select(Target):Lure.Select(Target,this.Parent.Content),null===this.Target&&(this.Target=this.Parent.Content)):null!==Target&&(this.Target=Lure.Select(Target)),null===Content?(this.Content=this.Target,construct.call($this)):null===Content.match(/<[^>]+>/)?(console.log("get load"),Lure.GetFileText(Content).then(function(t){MakeContent.call($this,t),construct.call($this)})):(MakeContent.call($this,Content),construct.call($this)),null===this.Content||null===this.Target)return void(this.isContent=!1);if(""!==CSS){var node=document.createElement("style");node.innerHTML=CSS,document.body.appendChild(node)}}}return _createClass(LureContent,[{key:"RefreshOne",value:function(t){this.Controller&&this.Controller.RefreshOne(t)}},{key:"Remove",value:function(t,e){this.Controller&&this.Controller.Remove(t,e)}},{key:"Add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Controller&&this.Controller.Add(t,e,n,i)}},{key:"Edit",value:function(t,e){this.Controller&&this.Controller.Edit(t,e)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactive(),delete this.Controller,delete this.Control}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(t){this.TitleContent.innerHTML=t}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:null},set:function(t){this.Controller&&(this.Controller.Data=t)}},{key:"Items",get:function(){return this.Controller?this.Controller.Items:null}}]),LureContent}(),Control:function(){function t(e,n){var i=this;_classCallCheck(this,t),null!==e&&e.length>0&&!function(){for(var t=i,r=function(i){e[i].Name||(e[i].Name="unnamed_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),t[e[i].Name]={Content:Lure.SelectAll(e[i].Target),_Content:e[i].Target,Type:e[i].Type?e[i].Type:"Untyped",isGlobal:e[i].Global,OnClick:e[i].OnClick?e[i].OnClick:n.Show,OnChange:e[i].OnChange,Active:function(){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.add("active")})},Disactive:function(){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.remove("active")})}},t[e[i].Name].Content.forEach(function(t){t.classList.add("pointer")}),e[i].Global?Lure.AddEventListenerGlobal("click",e[i].Target,function(r){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.remove("active")}),r.target.classList.add("active"),t[e[i].Name].OnClick&&t[e[i].Name].OnClick.call(n,r)}):t[e[i].Name].Content.forEach(function(r){r.onclick=function(r){Lure.ContentList[n.Type].forEach(function(t){t!==n&&t.Control&&t.Control.Disactive()}),t[e[i].Name].Content.forEach(function(t){t.classList.remove("active")}),r.currentTarget.classList.add("active"),t[e[i].Name].OnClick.call(n,r)}}),e[i].OnChange&&(e[i].Global?Lure.AddEventListenerGlobal("change",e[i].Target,function(t){e[i].OnChange.call(n,t)}):t[e[i].Name].Content.forEach(function(t){t.onchange=function(t){e[i].OnChange.call(n,t)}}))},o=0;o<e.length;o++)r(o)}()}return _createClass(t,[{key:"Active",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&this[e].Content.forEach(function(t){t.classList.add("active")})}},{key:"Disactive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&(this[e].Content.forEach(function(t){t.classList.remove("active")}),this[e].isGlobal&&Lure.SelectAll(this[e]._Content).forEach(function(t){t.classList.remove("active")}))}}]),t}(),Controller:{Templator:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?null:n,r=e.Data,o=void 0===r?[]:r,l=e.ListElement,a=void 0===l?".list_element":l,s=e.EmptyMessage,u=void 0===s?"":s,h=e.EmptyHide,d=void 0!==h&&h,c=e.PageSize,f=void 0===c?-1:c,C=e.DataCount,g=void 0===C?-1:C,_=e.PageGet,v=void 0===_?null:_,p=e.ShowAllButton,$=void 0===p||p,S=e.LineSave,m=void 0===S?function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};setTimeout(function(){i()},500)}:S,y=e.LineAdd,L=void 0===y?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};setTimeout(function(){e()},500)}:y,T=e.EditModeSwitch,b=void 0===T?null:T,D=(e.DataSaveAll,e.NoAnimation),A=void 0!==D&&D,P=e.NoBuild,E=void 0!==P&&P,B=e.BeforeBuild,w=void 0===B?function(){}:B,k=e.AfterBuild,F=void 0===k?function(){}:k,N=e.AfterAdd,H=void 0===N?function(){}:N,O=e.Parent,M=void 0===O?null:O;_classCallCheck(this,t);var I=this;this.isController=!0,null!==M?this.Content=Lure.Select(i,M.Content):this.Content=Lure.Select(i),this.Target=this.Content,this._Data=o,this.EmptyMessage=u,this.ListElement="",this.BeforeBuild=w.bind(this),this.AfterBuild=F.bind(this),this.AfterAdd=H.bind(this),this.Parent=M,this.PageSize=f,this._PageSize=f,this._DataCount=g>0?g:this._Data.length,this._PageCursor=0,this._PageGet=v,this.LineAdd=L,this.LineSave=m,this.Type=null,this.isShowAllButton=$,this.isNoAnimaton=A,this.isEmptyHide=d;var G=[];this._Dictionary=G;var R=function(){I._Data||(I._Data={});for(var t=0;t<G.length;t++)for(var e=0;e<G[t].fields.length;e++){var n=G[t].fields[e].Target.indexOf("attributes")>-1,i=G[t].fields[e].BuildValue(I._Data);n?G[t].obj.attributes[G[t].fields[e].Target.split(".")[1]].value=i:G[t].obj[G[t].fields[e].Target]=G[t].fields[e].BuildValue(I._Data)}};this._Rebuilder=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I._Data,e="";0===I._PageCursor&&I.Content.querySelectorAll(".mt-line, .mt-paginator, .mt-empty").forEach(function(t){t.remove()});var n=void 0,i=t.length;if(I._DataCount=g>0?g:i,I.PageSize>0){I._DataCount=I._DataCount>0?I._DataCount:t.length;var r=I.Content.querySelector(".mt-paginator");null!==r&&r.remove(),i=parseInt(I._PageCursor)+parseInt(I.PageSize),i>I._DataCount&&I._DataCount>0&&(i=I._DataCount),n=I._DataCount-i,n>I.PageSize&&(n=I.PageSize)}if("ItemList"===I.Type&&0===t.length&&""!==I.EmptyMessage&&!I.isEmptyHide){var o=I.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),l=document.createElement(o);return l.classList.add("mt-empty"),l.innerHTML=I.EmptyMessage,void I.Content.appendChild(l)}if("ItemList"===I.Type&&0===t.length&&I.isEmptyHide)return void(I.Content.style.display="none");if(0!==t.length){for(var a=I._PageCursor;a<i;a++)e+=I._LineBuilder(t[a],a,t.length);if(I.Content.children.length<1?I.Content.innerHTML=e:(e=Lure.CreateElementsFromString(e,I.Content.tagName),null!==e&&e.forEach(function(t){I.Content.appendChild(t)})),I.PageSize>0&&(I._PageCursor=i),I.PageSize>0&&I._PageCursor<I._DataCount){var s=void 0,u="<span>  (Не загружено "+(I._DataCount-I._PageCursor)+") </span>";I.isShowAllButton&&(u='<span> или </span><span class="mt-btn-nextAll dotted pointer"> Все ( '+(I._DataCount-I._PageCursor)+" )</span>");var h="table"===I.Content.tagName||"thead"===I.Content.tagName||"tbody"===I.Content.tagName;if(h){var d=I.Content.querySelector("tr:first-child th").length+1;s='<tr class="mt-paginator"><td colspan="'+d+'" class="element block-head"><span class="tpltr-next dotted pointer">Показать еще '+n+"</span>"+u+"</td></tr>",s=Lure.CreateElementFromString(s,I.Content.tagName)}else s=Lure.CreateElementFromString("<div class='mt-paginator'><span class=\"mt-btn-next dotted pointer\">Показать еще "+n+"</span>"+u+"</div>");var c=s.querySelector(".mt-btn-next");c.onclick=function(){I._PageCursor>=t.length?I._PageGet(I._PageCursor,I.PageSize,z):x()};var f=s.querySelector(".mt-btn-nextAll");f.onclick=function(){I.PageSize=I._DataCount,null!==I._PageGet?I._PageGet(I._PageCursor,I._DataCount-I._PageCursor,z):x()},I.Content.appendChild(s)}}};var x=function(){I.BeforeBuild(),"Refresh"===I.Type?R():"ItemList"===I.Type&&I._Rebuilder(),I.AfterBuild()},z=function(t){for(var e=0;e<t.length;e++)I._Data.push(t[e]);x()};if(this.FieldAdd=function(t){for(var e=t.attributes,n=[],i=-1,r=0;r<e.length;r++)e[r].value.indexOf("{{")>-1&&("value"!==e[r].name?n.push({Target:"attributes."+e[r].name,BuildValue:Lure.Compile(e[r].value)}):n.push({Target:e[r].name,BuildValue:Lure.Compile(e[r].value)}),i=0);t.childNodes.length<2&&t.innerHTML.indexOf("{{")>-1&&(n.push({Target:"innerHTML",BuildValue:Lure.Compile(t.innerHTML)}),i=0!==i?1:2),i>-1&&G.push({obj:t,fields:n})},this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;I.PageSize=I._PageSize,I._PageCursor=0,null!==t&&(I._Data=t),I.PageCursor=0,null===e?x():I.RefreshOne(e)},this.RefreshOne=function(t){var e=Lure.CreateElementFromString(I._LineBuilder(I._Data[t],t,I._Data.length),I.Content.tagName),n=I.Items[t];I.Items[t].parentNode.replaceChild(e,n)},this.Add=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];0===I._Data.length&&null!==I.Content.querySelector(".mt-empty")&&I.Content.querySelector(".mt-empty").remove();var r=document.createDocumentFragment(),o=document.createElement(I.Content.tagName),l=void 0;if(n){for(l=0,I.Items.forEach(function(t){console.log(t),console.log(t.dataset.line),t.dataset.line=parseInt(t.dataset.line)+1}),o.innerHTML=I._LineBuilder(t,0,I._Data.length+1);o.childNodes[0];)r.appendChild(o.childNodes[0]);e&&r.children[0].classList.add(e),i&&I._Data.unshift(t),I.Content.prepend(r)}else{for(l=I._Data.length,i||l--,o.innerHTML=I._LineBuilder(t,l,l+1);o.childNodes[0];)r.appendChild(o.childNodes[0]);e&&r.children[0].classList.add(e),i&&I._Data.push(t),I.Content.appendChild(r)}null!==I.LineAdd&&I.LineAdd(t,function(){var t=I.Content.querySelector("."+e);t&&t.classList.remove(e)}),I.AfterAdd(t,l)},this.Edit=function(t,e){console.log("edit itemData",e,t),Array.from(I.Items).filter(function(t){return parseInt(t.dataset.line)===e})[0].classList.add("editable-waiting"),I.LineSave(e,"$this",t,function(){I._Data[e]=t,I.RefreshOne(e)})},this.Remove=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I.Content.querySelector('.mt-line[data-line="'+t+'"]').remove();for(var n=t;n<I.Items.length;n++)I.Items[n].dataset.line=parseInt(I.Items[n].dataset.line)-1,I.Items[n].querySelectorAll("[data-line]").forEach(function(t){t.dataset.line=parseInt(t.dataset.line)-1});e&&I._Data.splice(t,1),0===I._Data.length&&I.Refresh()},this.SwitchToEditMode=function(){Lure.Editable.EditMode=!0,Lure.SelectAll(".editable",I.Content).forEach(function(t){Lure.Editable.AddEdits(t)})},Array.isArray(this._Data)){this.Type="ItemList";var V=null!==a.match(/^[a-zA-Z0-9.,\-_ *#]+$/g);if(V){var W=this.Content.querySelector(a);W.classList.add("mt-line"),a=W.outerHTML,W.remove()}else{var q=a.match(/<[^>]+>/)[0],j=void 0,U=q.indexOf('class="');U<0?j=q.substr(0,q.length-1)+' class="mt-line"'+q.substr(q.length-1):(U=q.indexOf('"',U+8),j=q.substr(0,U)+" mt-line"+q.substr(U)),a=a.replace(q,j)}a=a.replace(/<[\s\S]+?(>)/,function(t,e){return t.replace(e,' data-line="{{i}}">')}),this.ListElement=a,this._LineBuilder=Lure.Compile(a,!0),null!==a.match(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/)&&(this.isHasEditable=!0,null!==b&&Lure.Select(b).addEventListener("change",function(t){t.currentTarget.checked?I.SwitchToEditMode():(Lure.Editable.EditMode=!1,document.body.click())})),this.Content.MonsieurController=this,this.Content.classList.add("mt-content")}else{this.Type="Refresh";var Z=Array.prototype.slice.call(this.Content.querySelectorAll("*:not(g):not(path):not(clipPath):not(text):not(br)"));Z.push(this.Content),Z.forEach(function(t){I.FieldAdd(t)})}Lure.TemplatorList.push(this),E||x()}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}},{key:"Items",get:function(){return this.Content.querySelectorAll(".mt-line")}}]),t}(),TreeBuilder:function(){function t(e){var n=e.Target,i=void 0===n?null:n,r=e.Data,o=void 0===r?[]:r,l=e.ListElement,a=void 0===l?null:l,s=e.Drop,u=void 0!==s&&s,h=e.SubSelector,d=void 0===h?null:h,c=e.SubSelectorHandler,f=void 0===c?function(){}:c,C=e.BeforeBuild,g=void 0===C?function(){}:C,_=e.AfterBuild,v=void 0===_?function(){}:_,p=e.Parent,$=void 0===p?null:p;_classCallCheck(this,t),this.isController=!0,this.Content=Lure.Select(i),this.Target=this.Content,this.Parent=$,this._Data=o,this.SubSelector=d,this.SubSelectorHandler=f.bind(this),this.BeforeBuild=g.bind(this),this.AfterBuild=v.bind(this);var S=u?"mtb-sub_tree dropable":"mtb-sub_tree",m=0,y=null===a?this.Content.innerHTML:a;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",y=y.replace(/^([\s\S]*)(<\/\w+>)$/,function(t,e,n){return n='<div class="'+S+'"></div>'+n,e+n})),this.LineBuilder=Lure.Compile(y,!0);var L=this,T=0,b=function A(t,e,n){T++;var i={$lvl:m,$key:e,$index:T,$j:n},r=Lure.CreateElementFromString(L.LineBuilder(t,T,null,i));r.classList.add("mtb-branch");for(var o in t){var l=t[o];if(Array.isArray(l)){m++;for(var a=0;a<l.length;a++)if(null===L.SubSelector)r.appendChild(A(l[a],o,a));else{r.classList.add("mtb-has_tree"),u&&r.classList.add("dropable");var s=r.querySelector(L.SubSelector);s.appendChild(A(l[a],o,a))}m--}}return r},D=function(){if(L.BeforeBuild(),Array.isArray(L._Data)){L.Content.innerHTML="",m++;for(var t=0;t<L._Data.length;t++)L.Content.appendChild(b(L._Data[t],"root",0));m--}else L.Content.appendChild(b(L._Data,"root",0));m=0,T=0,L.AfterBuild()};D(this._Data),this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L._Data;L._Data=t,D()}}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}}]),t}()}},Lure.Content=Lure.Plugin.Content.Content;
//# sourceMappingURL=lure.content.min.js.map
