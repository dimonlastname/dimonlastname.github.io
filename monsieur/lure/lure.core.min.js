"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Date.prototype.format||(Date.prototype.format=function(e){return Lure._DateFormat(this,e)});var Lure=function(){var LureClass=function(){function LureClass(){_classCallCheck(this,LureClass),this.Plugin={};var $this=this;this.Debug=!1,this.isEditableEventsEnabled=!1;var regexEach=new RegExp(/{{#each\s+([^}]+)}}/g),regexIfOuter=new RegExp(/{{#if\s+([^}]+)}}([\s\S]*?){{#endif}}/g),regexIfInner=new RegExp(/{{#if([\s\S]*?)}}/g),regexExpressions=new RegExp(/{{([^#}]+)}}/g),regexEditable=new RegExp(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/g),spaces="    ",preCompileIfOuter=function(e){return e=e.replace(/#IF/g,"#if").replace(/#ENDIF/g,"#endif").replace(regexIfOuter,function(e,t,n){return'`+\n/* OUTER "IF" */\n(function($this){\n    if ('+preParseObjectChecker(t)+") {\n        return `"+n+"`;\n    }\n    return '';\n})($this)+`"})},preCompileIfInner=function(e){return e=e.replace(regexIfInner,function(e,t){return t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/g," < ").replace(/#more/g," > ").replace(/&amp;/g,"&").replace(/\|/g,'"'),'`+\n    /* LOCAL "IF" */\n    (function(){\n        return ('+t+"); \n        return '';})()+`"})},preCompileEach=function(e){e=e.replace(/{{#EACH/g,"{{#each").replace(/{{#ENDEACH/g,"{{#endeach");var t=e.match(regexEach),n=0;if(null!==t)for(var r=t.length-1;r>=0;r--){var i=t[r],a=!1;n++;var l=e.indexOf(i),o=e.indexOf("{{#endeach}}",l),s=e.slice(0,l).match(regexEach);s=null!==s?s.length:0;var c=e.slice(0,l).match(/{{#endeach}}/g);c=null!==c?c.length:0,s>c&&(a=!0,n=0);var d=e.slice(l,o+12),u=d.slice(i.length,d.length-12),p=i.replace(/{{#each\s+([\s\S]+)}}/,function(e,t){return t});p=preParseObjectChecker(p);var g="`+"+spaces.repeat(n)+"/* EACH */(function(inner, $parent){                                                                   \r\n"+spaces.repeat(n)+"    if (!inner || (Object.keys(inner).length === 0 && inner.constructor === Object && isNaN(inner)))   \r\n"+spaces.repeat(n)+'        return "";                                                                                     \r\n'+spaces.repeat(n)+'    let string_result= "";                                                                             \r\n'+spaces.repeat(n)+"    for(let j = 0; j < inner.length; j++){                                                             \r\n"+spaces.repeat(n)+"        let $this = inner[j];                                                                          \r\n"+spaces.repeat(n)+"        let o = inner[j];                                                                              \r\n"+spaces.repeat(n)+"        string_result = string_result + `"+preParse(u)+"`;                                \r\n"+spaces.repeat(n)+"    }                                                                                                  \r\n"+spaces.repeat(n)+"    return string_result;                                                                              \r\n"+spaces.repeat(n)+"})("+p+', {$parent: typeof $parent !== "undefined"?$parent:null, $this: $this, i: i} ) +`         ';e=e.replace(d,g)}return e},preCompileEditable=function(e){return e.replace(regexEditable,function(e,t,n){return e=e.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(t,' data-line="{{i}}" data-property="'+n.replace("{{","").replace("}}","")+'">')}),e.replace(n,'<div class="editable-helper editable-value">'+n+'</div><div class="editable-helper editable-icon"></div>')})},preParseObjectChecker=function(e){function t(e){var t=e.replace(/\s/g,""),n=t.indexOf("$item")>-1||t.indexOf("$this")>-1||t.indexOf("$parent")>-1,r=t.indexOf("$index")>-1||t.indexOf("$j")>-1||t.indexOf("$key")>-1||t.indexOf("$lvl")>-1||t.indexOf("$g.")>-1,i="?"===t||t.indexOf("=")>-1||t.indexOf(">")>-1||t.indexOf("<")>-1,a=null!==t.match(/^["'\\][\s\S]*["'\\]$/),l="i"===t||"j"===t,o=!isNaN(t);return n||r||l||o||a||i?t.indexOf("$g.")>-1?t.replace("$g.",""):e:"o."+t}return e.indexOf("Available + Dis")>-1,e=e.replace(/[^\-+\/%()*]+/g,function(e){var n=e.match(/&/g);if(null!==n){for(var r=0;r<n.length;r++)e=r<n.length-1?e.replace("&","$parent"):e.replace("&","$parent.$this");return e}return t(e)}),e=e.replace(/\\'/g,"'"),e="("+e+")"},preParse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(regexExpressions,function(e,n){return t?"${"+preParseObjectChecker(n)+"}":"${"+n+"}"})};this.Compile=function(e,t){e=e.replace(/[\n]+/g," ").replace(/[ ]{3,}/g,""),e=e.replace(/'/g,"\\'"),t&&(e=preCompileEditable(e),e=preCompileIfOuter(e),e=preCompileEach(e)),e=preParse(e),e=preCompileIfInner(e);var n="\nlet $this = o;\nlet $item = o;\nlet $num = i+1;\nlet $denum = length-i;\n//treebuilder's\nlet $index;\nlet $key;\nlet $lvl;\nlet $j;\nif (extra){\n    $index = extra.$index;\n    $key = extra.$key;\n    $lvl = extra.$lvl;\n    $j = extra.$j;\n}\nlet string_Result = \"\";\nif (o === undefined || (Object.keys(o).length === 0 && o.constructor === Object && isNaN(o)) ) \n    return '';\nreturn `";n+=e+"`;",n=n.replace(/`/g,"'").replace(/\$\{([^}]*)\}/g,function(e,t){return"'+"+t+"+'"});var r=void 0;try{r=new Function("o","i","length","extra",n)}catch(i){console.info(n),console.error(i)}return r},this._EditablesEventListenerRun=function(e){$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("click",".editable-icon",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget.closest(".editable"))},e),$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("change",".editable-editor",function(e){var t=e.currentTarget.value,n=e.currentTarget.parentElement.dataset.value;t!==n?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("keyup",".editable-textbox",function(e){if(13===e.keyCode)return $this.Editable.Save(e.currentTarget.closest(".editable"),e.currentTarget.value),!1;var t=e.currentTarget.value,n=e.currentTarget.parentElement.dataset.value;t!==n?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("click",".editable-save-button",function(e){var t=e.currentTarget.closest(".editable");$this.Editable.Save(e.currentTarget.closest(".editable"),t.querySelector(".editable-editor").value)},e),$this.isHasEditablesEventsEnabled||(document.addEventListener("click",function(e){e.target.classList.contains("editable-helper")&&null!==document.querySelectorAll(".editable-helper, .editable-editing")||$this.Editable.RemoveEdits()}),$this.isHasEditablesEventsEnabled=!0)},this.CreateElementFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=document.createDocumentFragment(),r=document.createElement(t);for(r.innerHTML=e;r.childNodes[0];)n.appendChild(r.childNodes[0]);return n.childNodes[0]},this.CreateElementsFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=document.createDocumentFragment(),r=document.createElement(t);for(r.innerHTML=e;r.childNodes[0];)n.appendChild(r.childNodes[0]);if(n.childNodes.length>0){for(var i=[],a=0;a<n.childNodes.length;a++)i.push(n.childNodes[a]);return i}return null},this.Select=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return""===e||null===e?null:e instanceof Node?e:t.querySelector(e)},this.SelectAll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"undefined"==typeof e?[]:"undefined"!=typeof e.tagName||e===document?[e]:t.querySelectorAll(e)},this.AddEventListenerGlobal=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,i=arguments[4];r.addEventListener(e,function(e){var a=e.target,l=!1,o=Lure._EventClone(e),s=r.querySelectorAll(t);if(s[0]===a&&(o.currentTarget=a,l=!0),!l)for(var c=0;c<s.length;c++)if(s[c].contains(a)){l=!0,o.currentTarget=a.closest(t);break}l&&n.call(i?i:o.currentTarget,o)})},this.isVisible=function(e){var t=function(e){var t=window.getComputedStyle(e);return"none"!==t.display&&"0"!==t.opacity&&"hidden"!==t.visibility&&((0!==parseInt(t.minWidth)&&"auto"!==t.minWidth||0!==parseInt(t.width))&&(0!==parseInt(t.minHeight)&&"auto"!==t.minHeight||0!==parseInt(t.height)))},n=function(e){for(;e.parentElement;){if(!t(e.parentElement))return!1;e=e.parentElement}return!0};return!!t(e)&&n(e)},this._EventClone=function(e){function t(){}var n=new t;for(var r in e){var i=Object.getOwnPropertyDescriptor(e,r);!i||i.writable&&i.configurable&&i.enumerable&&!i.get&&!i.set?n[r]=e[r]:Object.defineProperty(n,r,i)}return Object.setPrototypeOf(n,e),n},this.GetFileText=function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.onload=function(){t(r.response)},r.onerror=function(){n(new Error("XMLHttpRequest Error: "+this.statusText))},e=e.indexOf("..")>-1?e.replace("..",document.location.protocol+"//"+document.location.host):document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+e,console.log("Lure.GetFileText",e),r.open("GET",e),r.send()})},this.GetInlineSize=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1rem",n="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",r=document.createElement("div");for(var i in e.style)try{""!==e.style[i]&&e.style[i].indexOf(":")>0&&(r.style[i]=e.style[i])}catch(a){}document.all?r.style.setAttribute("cssText",n):r.setAttribute("style",n),r.style.fontSize=t,r.innerHTML=e.innerHTML,parent.document.body.appendChild(r);var l={width:r.clientWidth,height:r.clientHeight};return parent.document.body.removeChild(r),l},this.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this._DateFormat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD.MM.YYYY HH:mm:ss";if(null===e||"undefined"==typeof e)return"";var n=e.getDate(),r=e.getMonth(),i=e.getFullYear(),a=e.getHours(),l=e.getMinutes(),o=e.getSeconds();return t.replace("DD",n.toString().length<2?"0"+n:n).replace("D",n).replace("MMM",$this.Culture.MonthNames[r]).replace("MM",r.toString().length<2?"0"+r:r).replace("M",r).replace("YYYY",i).replace("YY",i.toString().substring(2,2)).replace("Y",i).replace("HH",a.toString().length<2?"0"+a:a).replace("hh",a).replace("mm",l.toString().length<2?"0"+l:l).replace("ss",o.toString().length<2?"0"+o:o)},this.Editable={EditMode:!1,RemoveWaiting:function(){var e=document.querySelectorAll(".editable-waiting");e.forEach(function(e){e.classList.remove("editable-waiting")})},RemoveEdits:function(){if(!$this.Editable.EditMode){var e=document.querySelectorAll(".editable-editing");e.forEach(function(e){e.innerHTML=e._innerHTML,e.classList.remove("editable-editing")}),$this.Editable.RemoveWaiting()}},AddEdits:function AddEdits(EditableElement){EditableElement._innerHTML=EditableElement.innerHTML;var ValuePrev=EditableElement.querySelector(".editable-value").innerHTML;EditableElement.classList.add("editable-editing"),EditableElement.dataset.value=ValuePrev;var SaveButton=$this.Editable.EditMode?"":'<div class="editable-helper editable-save-button"></div>';if(EditableElement.dataset.object){var string_Select='<select class="select editable-helper editable-editor editable-select">',SelectData=eval(EditableElement.dataset.object),Property=EditableElement.dataset.property,SelectOptions="";SelectData.forEach(function(e){var t="";if(("undefined"==typeof e?"undefined":_typeof(e))===_typeof({})){for(var n in e)t+=" data-property_"+n+'="'+e[n]+'"';string_Select+='<option class="editable-helper" '+t+">"+e[Property]+"</option>"}else string_Select+='<option class="editable-helper" '+(e===ValuePrev?"selected":"")+">"+e+"</option>"}),string_Select+="</select>"+SaveButton+"</div>",EditableElement.innerHTML=string_Select}else{var EditType=EditableElement.dataset.type;"undefined"==typeof EditType&&(EditType="text"),EditableElement.innerHTML='<input class="textbox editable-helper editable-editor editable-textbox" type="'+EditType+'" value="'+ValuePrev+'"> '+SaveButton,EditableElement.querySelector(".editable-editor").focus(),EditableElement.querySelector(".editable-editor").select()}},Save:function(e,t){var n=e.closest(".mt-content"),r=n.MonsieurController,i=e.dataset.line,a=e.dataset.property,l=r.Data[i];return""===t||null===t||"undefined"==typeof t?(console.info("New Value is empty"),void Lure.ErrorHint(e,"Пустое поле или неправильные данные")):(e.innerHTML=e._innerHTML,e.dataset.value=t,e.querySelector(".editable-value").innerHTML=t,e.classList.remove("editable-editing"),"$this"!==a&&"$item"!==a?l[a]=t:l=t,void r.LineSave(i,a,t,function(){Lure.Editable.RemoveWaiting(),"$this"!==a&&"$item"!==a?r.Data[i][a]=t:r.Data[i]=t}))}},this.Settings={DialogBlur:null,DialogAnimation:"monsieur-animation-dialog",EditableClass:"editable",EditableWaiting:"editable-waiting"},this.Culture={MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesShort:["янв.","фев.","мар.","апр.","май","июн.","июл.","авг.","сен.","окт.","ноя.","дек."],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]},this.TemplatorList=[],this.ContentList={},this._DialogCount=0}return _createClass(LureClass,[{key:"Perf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Perf",n=Math.floor(100*(window.performance.now()-e))/100;return console.info("["+t+"]: "+n+"ms"),n}},{key:"Confirm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Achtung",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.CaptionColor,i=void 0===r?"":r,a=n.CaptionBackground,l=void 0===a?"":a,o=n.OnAgree,s=void 0===o?function(){}:o,c=n.OnCancel,d=void 0===c?null:c;document.activeElement.blur();var u=document.createElement("div");u.classList.add("monsieur-confirm"),Lure.Settings.DialogAnimation&&u.classList.add(Lure.Settings.DialogAnimation);var p=document.createElement("div");p.classList.add("cd-caption"),p.innerHTML=e,p.style.color=i,p.style.background=l,u.appendChild(p);var g=document.createElement("div");g.classList.add("cd-text"),g.innerHTML=t,u.appendChild(g);var f=document.createElement("div");f.classList.add("cd-buttons"),u.appendChild(f);var h=document.createElement("div");if(h.classList.add("button","cd-button","btn-diag-confirm"),h.innerHTML="Ok",h.onclick=function(){Lure._DialogCount--,null!==s&&void 0!==s&&s(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("monsieur-blur"),v.remove(),u.remove()},u.getElementsByClassName("cd-buttons")[0].appendChild(h),null!==d){var m=document.createElement("div");m.classList.add("button","cd-button","btn-diag-cancel"),m.innerHTML="Отмена",m.onclick=function(){Lure._DialogCount--,null!==d&&d(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("monsieur-blur"),v.remove(),u.remove()},u.getElementsByClassName("cd-buttons")[0].appendChild(m)}var v=document.createElement("div");v.classList.add("ConfirmDialog-wrapper"),document.body.appendChild(v),document.body.appendChild(u),Lure._DialogCount++,Lure.Settings.DialogBlur&&(v.style.background="none",Lure.Select(Lure.Settings.DialogBlur).classList.add("monsieur-blur"))}},{key:"NoFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==e&&(e='"'+e+'"'),this.Confirm("Error","Sorry, function "+e+" is not available yet")}},{key:"ErrorHint",value:function(e,t){t||(t="Поле не может быть пустым");var n=document.createElement("div");n.classList.add("monsieur-error-hint"),n.innerHTML=t,e.parentElement.style.position="relative",e.parentElement.appendChild(n),n.style.display="block";try{n.animate({opacity:[0,1]},{duration:300})}catch(r){}setTimeout(function(){try{n.animate({opacity:[1,0]},{duration:300}).onfinish=function(){n.style.display="none"}}catch(t){n.style.display="none"}setTimeout(function(){e.parentElement.style.position="",n.remove()},500)},2e3)}}]),LureClass}();return new LureClass}();
//# sourceMappingURL=lure.core.min.js.map
