"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();Lure.Plugin.Chart={Core:"",Chart:function(){function t(){function e(){var t="",e="",i="",a="",s="",r=S.Options.Series.filter(function(t){return"pie"===t.Type}).length!==S.Options.Series.length;console.log("isGraph",r);var n=void 0;r&&(n=m.MakeGraph);for(var l=0;l<S.Options.Series.length;l++)t+=m.MakeLegend(S.Options.Series[l],l),e+=m.MakeAxisY(S._ScaleY.Scales[l],l,S.Options.Series[S._ScaleY.Dict[l]].Title?S.Options.Series[S._ScaleY.Dict[l]].Title:S.Options.Series[S._ScaleY.Dict[l]].Name,S.Options.Series[S._ScaleY.Dict[l]].Color),s+=n(S.Options.Series[l],l);t='<div class="mt-chart-legend row">'+t+"</div>",e='<div class="mt-chart-y row">'+e+"</div>",i=m.MakeAxisX(),a=m.MakeGrid(S.Options.Labels.Data.length,S._ScaleY.Scales[0].length-1),S.Content.innerHTML='<div class="mt-chart col">\n                        <div class="mt-chart-caption">\n                          <div class=\'mt-chart-title\'>'+o+'</div>\n                          <div class="mt-chart-legend row">'+t+'</div>\n                        </div>\n                        <div class="mt-chart-kek row flex-100">\n                          <div class="mt-chart-y row">'+e+'</div>\n                          <div class="col flex-100">\n                            <div class="mt-chart-area row flex-100">\n                              <svg class="mt-chart-svg">'+s+'</svg>\n                              <div class="mt-chart-grid" style=" position: absolute;">'+a+'</div>\n                            </div>\n                            <div class="mt-chart-x row">'+i+"</div>\n                           </div>\n                        </div>\n                      </div>"}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.Type,r=void 0===s?"Line":s,n=a.Title,o=void 0===n?"":n,l=a.Labels,c=void 0===l?{Rotation:"auto",Data:[]}:l,h=a.Series,u=void 0===h?[{Data:[],Type:"",OwnAxis:!1,Color:"#eee"},{Data:[],Type:"",OwnAxis:[0,100],Color:"#eee"}]:h,d=a.Tooltip,p=void 0===d?{Template:"Name: {{Name}}<br>Value: {{Value}}"}:d,v=a.AxisY,f=void 0===v?{Scale:["auto","auto","auto"],Visible:!0}:v;a.Height,a.SeriesOptions;_classCallCheck(this,t);var g=["red","green","cornflowerblue","purple","palevioletred","orange"],S=this;this.Content=Lure.Select(i),this.Content.classList.add("mt-chart"),this.Content.style.position="relative",this.isGraph=!0;var b={Legend:"",AxisX:"",AxisY:"",Grid:"",Svg:"",Height:0,Width:0,Abscissa:null,SeriesPoints:[],ParametersAxisX:null};this._Series=u,this.__InitSeries=function(){for(var t=[],e=0;e<this._Series.length;e++){var i={};i.Name=this._Series[e].Name?this._Series[e].Name:"Unnamed",i.Data=this._Series[e].Data,i.OwnAxis=this._Series[e].OwnAxis,i.Title=this._Series[e].Title?this._Series[e].Title:i.Name,i.Type=this._Series[e].Type?this._Series[e].Type.toLowerCase():r?r.toLowerCase():"line",i.Color=this._Series[e].Color?this._Series[e].Color:g[e]?g[e]:"#000",i.Width=this._Series[e].Width?this._Series[e].Width:2,i.Point=u[e].Point,i.Point=Lure.Chart.GetSeriePointOptions(i),b.Legend+=Lure.Chart.MakeLegend(i,e),t.push(i)}return t}.bind(this),this.Options={Title:o?o:"",Labels:{Visible:"undefined"==typeof c.Visible||c.Visible,Rotation:c.Rotation?c.Rotation:"auto",Data:c.Data?c.Data:[]},Series:this.__InitSeries(),SeriesOptions:{BarStack:!1,BarGradient:!0},AxisY:{Scale:f.Scale?[Lure.isNumeric(f.Scale[0])?f.Scale[0]:"auto",Lure.isNumeric(f.Scale[1])?f.Scale[1]:"auto",Lure.isNumeric(f.Scale[2])?f.Scale[2]:"auto"]:["auto","auto","auto"],Visible:"undefined"==typeof f.Visible||f.Visible},Tooltip:{Template:p.Template?p.Template:"Name: {{Name}}<br>Value: {{Value}}"}},this.Block=function(){this.Content.innerHTML='<div class="mt-chart col">\n                                        <div class="mt-chart-caption">\n                                          <div class=\'mt-chart-title\'>'+o+'</div>\n                                          <div class="mt-chart-legend row"></div>\n                                        </div>\n                                        <div class="mt-chart-kek row flex-100">\n                                          <div class="mt-chart-y row"></div>\n                                          <div class="col flex-100">\n                                            <div class="mt-chart-area row flex-100">\n                                              <svg class="mt-chart-svg"></svg>\n                                              <div class="mt-chart-grid" style=" position: absolute;"></div>\n                                            </div>\n                                            <div class="mt-chart-x row"></div>\n                                           </div>\n                                        </div>\n                                      </div>';var t=this.Content.querySelector(".mt-chart-legend"),e=this.Content.querySelector(".mt-chart-x"),i=this.Content.querySelector(".mt-chart-y"),a=this.Content.querySelector(".mt-chart-area"),s=this.Content.querySelector(".mt-chart-grid"),r=this.Content.querySelector(".mt-chart-svg");return{get Legend(){return t},set Legend(e){t.innerHTML=e},get AxisX(){return e},set AxisX(t){e.innerHTML=t},get AxisY(){return i},set AxisY(t){i.innerHTML=t},get ChartArea(){return a},set ChartArea(t){a.innerHTML=t},get Grid(){return s},set Grid(t){s.innerHTML=t},get Svg(){return r},set Svg(t){r.innerHTML=t}}}.bind(this)();var m={MakeLegend:function(t,e){return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" checked="checked" id="legcheck'+t.Name+e+'">\n                          <div class="mt-legend-icon" style="background-color: '+t.Color+'"></div>\n                          <label class="mt-legend-label" for="legcheck'+t.Name+e+'">'+t.Name+"</label>\n                        </div>"},MakeAxisY:function(){var t=0;if(!S.Options.AxisY.Visible&&(t=1,S._ScaleY.Scales.length<2))return"";var e="";for(t;t<S._ScaleY.Scales.length;t++){var i=S._ScaleY.Dict.indexOf(t),a=S._ScaleY.Scales[t],s="";t>0&&(s='<div class="mt-chart-axis-caption"><div style="transform: rotate(-90deg)">'+S.Options.Series[i].Title+"</div></div>");for(var r="",n=0;n<a.length;n++)r+='<div class="mt-chart-label mt-chart-label__y"><span>'+a[n]+"</span></div>";e+='<div class="mt-chart-axis__y row" '+(t>0?'style="color: '+S.Options.Series[i].Color+'; font-weight: bold;"':"")+' data-line="'+t+'">'+s+'<div class="mt-chart-labels col">'+r+"</div></div>"}return e},MakeAxisX:function(){if(!S.Options.Labels.Visible)return"";for(var t=S.Options.Labels.Data,e="transform: rotate("+b.ParametersAxisX.Angle+"deg); margin-top: "+b.ParametersAxisX.MarginTop+"px; width: "+b.ParametersAxisX.Width+"px; margin-left: "+b.ParametersAxisX.MarginLeft+"px;",i="",a=0;a<t.length;a++)i+='<div class="mt-chart-label mt-chart-label__x"><span style="'+e+'">'+t[a]+"</span></div>";return i},MakeGrid:function(t,e){return Lure.Chart.GetGrid(t,e)},MakeGraph:function(t,e){var i=S._ScaleY.Dict[e],a=S._ScaleY.Scales[i],s=S._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,a,s,S.Height),n=Lure.Chart.GetAbscissa(S.Options.Labels.Data,S.Width),o=Lure.Chart.GetPoints(n,r);return Lure.Chart.GetPath(o,S.Options.Series[e].Type,e,S.Options.Series[e].Color,S.Options.Series[e].Width)},CalcAxisX:function(){var t=Lure.CreateElementFromString('<div class="mt-chart-label mt-chart-label__x"><span>'+S.Options.Labels.Data[0]+"</span></div>"),e=Lure.GetInlineSize(t,getComputedStyle(t.querySelector("span")).fontSize),i=S.Width/S.Options.Labels.Data.length,a=e.height,s=e.width,r=void 0;if("auto"!==S.Options.Labels.Rotation)r=parseFloat(S.Options.Labels.Rotation);else{var n=(i-a)/(s+a);n<.1&&(n=0),n>1&&(n=1),r=-90*(1-n)}return{Height:Math.round(a/4+Math.sqrt(Math.pow(s,2)-Math.pow(i,2))),Width:s,MarginTop:s>i?Math.sqrt(Math.pow(s,2)-Math.pow(i,2))-a:0,MarginLeft:s>i?-i/2:-s/2,Angle:r}}};this.__GetPath=function(t,e){switch(t.Type){case"line":return this.__GetPathLine(t,e);case"bar":return this.__GetPathBar(t,e);case"pie":return""}}.bind(this),this.__GetPathLine=function(t,e){b.Abscissa&&b.Width===this.Width||(b.Abscissa=Lure.Chart.GetAbscissa(S.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],a=this._ScaleY.Scales[i],s=S._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,a,s,S.Height),n=Lure.Chart.GetPoints(b.Abscissa,r);b.SeriesPoints[e]=n;for(var o=n.length,l=[],c=[],h=[],u=[],d=[],p=[],v=0;v<o;v++)l[v]=n[v][0],c[v]=n[v][1];for(var f=0;f<o-1;f++)h[f]=c[f+1]-c[f],u[f]=l[f+1]-l[f],d[f]=h[f]/u[f];p[0]=d[0],p[o-1]=d[o-2];for(var g=1;g<o-1;g++)0===d[g]||0===d[g-1]||d[g-1]>0!=d[g]>0?p[g]=0:(p[g]=3*(u[g-1]+u[g])/((2*u[g]+u[g-1])/d[g-1]+(u[g]+2*u[g-1])/d[g]),isFinite(p[g])||(p[g]=0));for(var m="M "+l[0]+","+c[0],C='<g class="mt-chart-dots">',L=0;L<o-1;L++)m+=" C "+(l[L]+u[L]/3)+","+(c[L]+p[L]*u[L]/3)+" "+(l[L+1]-u[L]/3)+","+(c[L+1]-p[L+1]*u[L]/3)+" "+l[L+1]+","+c[L+1],t.Point.Visible&&(C+=Lure.Chart.GetPathLineDot(l[L],c[L],e,L,t.Color,t.Point.Radius));return t.Point.Visible&&(C+=Lure.Chart.GetPathLineDot(l[o-1],c[o-1],e,o-1,t.Color,t.Point.Radius)),C+="</g>",'<g class="mt-chart-serie"><path data-line="'+e+'" d="'+m+'" fill="none" stroke="'+t.Color+'" stroke-width="'+t.Width+'"></path> '+C+"</g>"}.bind(this),this.__GetPathBar=function(t,e){b.Abscissa&&b.Width===this.Width||(b.Abscissa=Lure.Chart.GetAbscissa(S.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],a=this._ScaleY.Scales[i],s=S._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,a,s,S.Height),n=Lure.Chart.GetPoints(b.Abscissa,r);b.SeriesPoints[e]=n;var o=this.Height,l=t.Width,c='<g class="mt-chart-serie" data-type="Bar">',h="";this.Options.SeriesOptions.BarGradient&&(h="bar_"+Math.random().toString(36).replace("0.",""),c+='<linearGradient id="'+h+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var u="",d=0;d<n.length;d++){var p="M "+(n[d][0]-l/2)+" "+o+" L "+(n[d][0]+l/2)+" "+o+" "+(n[d][0]+l/2)+" "+n[d][1]+" "+(n[d][0]-l/2)+" "+n[d][1]+"Z";c+='<path class="mt-chart-tooltipable" data-line="'+e+'" data-item="'+d+'" d="'+p+'" fill="'+t.Color+'" stroke="#000" stroke-width="0"></path>',this.Options.SeriesOptions.BarGradient&&(c+='<path class="mt-chart-tooltipable"  data-line="'+e+'" data-item="'+d+'" d="'+p+'" fill="url(#'+h+')" ></path>')}return c+=u+"</g>"}.bind(this),function(){this.Block.Legend=b.Legend,b.ParametersAxisX=m.CalcAxisX(),console.log("this.Height-Buffer.ParametersAxisX.Height",this.Height,b.ParametersAxisX.Height),this._ScaleY=Lure.Chart.GetScaleY(this.Options.Series,this.Height-b.ParametersAxisX.Height,this),this.Block.AxisX=m.MakeAxisX(),this.Block.Grid=Lure.Chart.GetGrid(this.Options.Labels.Data.length,this._ScaleY.Scales[0].length-1);var t=this.isGraph;console.log("isGraph",t);var e=void 0;t&&(e=m.MakeGraph);var i="",a="",s="";i=m.MakeAxisY(),this.Block.AxisY=i;for(var r=0;r<S.Options.Series.length;r++)switch(S.Options.Series[r].Type){case"line":s+=this.__GetPathLine(S.Options.Series[r],r);break;case"bar":a+=this.__GetPathBar(S.Options.Series[r],r)}this.Block.Svg=a+s,this.Block.AxisY.style.height=this.Height+"px"}.bind(this)(),this.Tooltip=new Lure.Content({Name:"Tooltipchek",Target:this.Block.ChartArea,Content:'<div class="mt-chart-tooltip">\n                        <div class="val">'+this.Options.Tooltip.Template+"</div>\n                      </div>",Visible:!1,Controller:{Data:{}},BeforeShow:function(t,e){},Prop:function(){this._Timer=null,this._Timer2=null},Shower:function(){clearTimeout(this._Timer),clearTimeout(this._Timer2),this.Content.style.display="",this.Content.style.opacity="1"},Hider:function(){clearTimeout(this._Timer),this._Timer=setTimeout(function(){this.Content.style.opacity="0",this._Timer2=setTimeout(function(){this.Content.style.display="none"}.bind(this),200)}.bind(this),500)},Show:function(t){clearTimeout(this._Timer),this.Data.Name=t.data[0],this.Data.Value=t.data[1],this.Refresh(),this.Content.style.left=t.pos[0]+7+"px",this.Content.style.top=t.pos[1]-this.Content.clientHeight-7+"px",this.Content.style.backgroundColor=t.color},Methods:function(){this.Do=function(t){var e=t.currentTarget.tagName.toLowerCase();switch(e){case"circle":this.DoCircle(t);break;case"path":this.DoBar(t)}}.bind(this),this.DoCircle=function(t){var e=t.currentTarget,i=parseInt(e.dataset.line),a=parseInt(e.dataset.item),s=e.attributes.stroke.value,r=parseInt(e.attributes["stroke-width"].value);e.attributes.fill.value=s,e.attributes.r.value=parseInt(e.attributes.r.value)+r,e.attributes.stroke.value="#fff";var n={data:[u[i].Name,u[i].Data[a]],color:s,pos:b.SeriesPoints[i][a]};this.Show(n)}.bind(this),this.DoBar=function(t){var e=t.currentTarget,i=parseInt(e.dataset.line),a=parseInt(e.dataset.item),s={data:[S.Options.Series[i].Name,S.Options.Series[i].Data[a]],color:S.Options.Series[i].Color,pos:b.SeriesPoints[i][a]};this.Show(s)}.bind(this)},AfterBuild:function(){}}),Lure.AddEventListenerGlobal("mouseover",".mt-chart-point, .mt-chart-tooltipable",function(t){this.Tooltip.Do(t)},this.Content,this),Lure.AddEventListenerGlobal("mouseout",".mt-chart-point",function(t){var e=t.currentTarget,i=parseInt(e.attributes["stroke-width"].value);e.attributes.stroke.value=e.attributes.fill.value,e.attributes.fill.value="#fff",e.attributes.r.value-=i,S.Tooltip.Hide()},this.Content);(function(){for(var t=[],e=0;e<u.length;e++){var i=this._ScaleY.Dict[e],a=this._ScaleY.Scales[i],s=this._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(u[e].Data,a,s,this.Block.Svg.Height);this._Abscissa=Lure.Chart.GetAbscissa(c.Data,this.Block.Svg.Width);var n=Lure.Chart.GetPoints(this._Abscissa,r);t[e]={h:this.Block.Svg.Height,Name:S.Options.Series[e].Name,Data:S.Options.Series[e].Data,DataPoints:n,Color:S.Options.Series[e].Color,Path:Lure.Chart.GetPath(n,S.Options.Series[e].Type,e,S.Options.Series[e].Color,S.Options.Series[e].Width),Width:S.Options.Width,options:{pointSize:u[e].Width?4+u[e].Width/4:4}}}return S.SuperData=t,t}).bind(this);this.TestB=function(){var t=performance.now();e(),Lure.Perf(t,"builder")},this.Refresh=function(){}.bind(this),this.Refresh(),setTimeout(function(){}.bind(this),0),this.Buffer=b}return _createClass(t,[{key:"Height",get:function(){return this.Block.Svg.clientHeight}},{key:"Width",get:function(){return this.Block.Svg.clientWidth}}],[{key:"GetSeriePointOptions",value:function(t,e){var i=t.Point?t.Point:{};return i.Visible="undefined"==typeof i.Visible||i.Visible,i.Radius=i.Radius?i.Radius:4+t.Width/4,Number.isNaN(i.Radius),i}},{key:"GetScaleY",value:function(t,e,i){if("pie"===i.Type)return[];var a=t[0].Data[0],s=t[0].Data[0],r=!0,n=!0;"auto"!==i.Options.AxisY.Scale[0]&&"auto"!==i.Options.AxisY.Scale[1]&&(r=!1,a=i.Options.AxisY.Scale[0],s=i.Options.AxisY.Scale[1]),"auto"!==i.Options.AxisY.Scale[2]&&(n=!1);for(var o=[[t[0].Data[0],t[0].Data[0]]],l=0,c={Scales:[],Dict:[],MinMax:null},h=0;h<t.length;h++){c.Dict[h]=0,t[h].OwnAxis&&(l++,"undefined"!=typeof t[h].OwnAxis[0]?o.push(t[h].OwnAxis):o.push([t[h].Data[0],t[h].Data[0]]),c.Dict[h]=l);for(var u=0;u<t[h].Data.length;u++)r&&(t[h].Data[u]<a&&(a=t[h].Data[u]),t[h].Data[u]>s&&(s=t[h].Data[u])),t[h].OwnAxis&&"undefined"==typeof t[h].OwnAxis[0]&&(t[h].Data[u]<o[l][0]&&(o[l][0]=t[h].Data[u]),t[h].Data[u]>o[l][1]&&(o[l][1]=t[h].Data[u]))}o[0]=[a,s],c.MinMax=o;for(var d=0;d<o.length;d++){var p=o[d][1].toString().length,v=void 0;v=0!==d||n?o[d][2]?o[d][2]:(40*(o[d][1]-o[d][0])/e/Math.pow(10,p-1)/5).toFixed(1)*Math.pow(10,p-1)*5:i.Options.AxisY.Scale[2];for(var f=o[d][0],g=[];f<=o[d][1];)g.push(f),f+=v;g.push(f),c.Scales.push(g)}return c}},{key:"GetAbscissa",value:function(t,e){var i=e/t.length;return t.map(function(t,e){return e*i})}},{key:"GetOrdinata",value:function(t,e,i,a){for(var s=i[0],r=i[1],n=e[e.length-1]/r,o=[],l=0;l<t.length;l++)o.push(a-(t[l]-s)*a/(r-s)/n);return o}},{key:"GetPoints",value:function(t,e){for(var i=[],a=0;a<e.length;a++)i.push([t[a],e[a]]);return i}},{key:"GetPath",value:function(t,e,i,a,s){switch(e){case"line":return Lure.Chart.GetPathLine(t,i,a,s);case"bar":return Lure.Chart.GetPathBar(t,i,a,s);case"pie":return""}}},{key:"GetPathLine",value:function(t,e,i,a){for(var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=t.length,n=[],o=[],l=[],c=[],h=[],u=[],d=0;d<r;d++)n[d]=t[d][0],o[d]=t[d][1];for(var p=0;p<r-1;p++)l[p]=o[p+1]-o[p],c[p]=n[p+1]-n[p],h[p]=l[p]/c[p];u[0]=h[0],u[r-1]=h[r-2];for(var v=1;v<r-1;v++)0===h[v]||0===h[v-1]||h[v-1]>0!=h[v]>0?u[v]=0:(u[v]=3*(c[v-1]+c[v])/((2*c[v]+c[v-1])/h[v-1]+(c[v]+2*c[v-1])/h[v]),isFinite(u[v])||(u[v]=0));for(var f="M "+n[0]+","+o[0],g='<g class="mt-chart-dots">',S=0;S<r-1;S++)f+=" C "+(n[S]+c[S]/3)+","+(o[S]+u[S]*c[S]/3)+" "+(n[S+1]-c[S]/3)+","+(o[S+1]-u[S+1]*c[S]/3)+" "+n[S+1]+","+o[S+1],s&&(g+=Lure.Chart.GetPathLineDot(n[S],o[S],e,S,i,a));return g+="</g>",'<g class="mt-chart-serie"><path data-line="'+e+'" d="'+f+'" fill="none" stroke="'+i+'" stroke-width="'+a+'"></path> '+g+"</g>"}},{key:"GetPathLineDot",value:function(t,e,i,a,s,r){return'<circle class="mt-chart-point" data-line="'+i+'" data-item="'+a+'" cx="'+t+'" cy="'+e+'" r="'+r+'" stroke="'+s+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"GetPathBar",value:function(t,e,i,a){console.log("GetPathBar",t);for(var s="",r=0;r<t.length;r++){"M "+t[r][0]+" "+t[r][1]+" L "+t[r][0]+" "+t[r][1];s+=Lure.Chart.GetPathLineDot(t[r][0],t[r][1],e,r,i,a)}return s}},{key:"MakeLegend",value:function(t,e){return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" checked="checked" id="legcheck'+t.Name+e+'">\n                          <div class="mt-legend-icon" style="background-color: '+t.Color+'"></div>\n                          <label class="mt-legend-label" for="legcheck'+t.Name+e+'">'+t.Name+"</label>\n                        </div>"}},{key:"GetGrid",value:function(t,e){for(var i="",a=0;a<e;a++){i+='<div class="mt-chart__grid-line row flex-100 flex-between">';for(var s=0;s<t;s++)i+="<div class='mt-chart__grid-item flex-100'></div>";i+="</div>"}return i+=""}}]),t}()},Lure.Chart=Lure.Plugin.Chart.Chart,Lure.__GenegateString=function(){var t=Math.random().toString(36).replace("0.","").replace(/[\d]+/,"").substring(0,1);return Lure.Select("#"+t)&&(t=Lure.__GenegateString()),t};
//# sourceMappingURL=lure.chart.min.js.map
