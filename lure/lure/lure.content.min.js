"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Lure.Plugin.Content={Version:"0.9",Content:function(){function LureContent(_ref){function MakeContent(t){null===Controller||Array.isArray(Controller.Data)?this.Content=Lure.CreateElementFromString(t):null===Controller||Array.isArray(Controller.Data)||(t=t.replace(/>[^>]*({{[^#}]+}})[^>]*</g,function(t,e){var n=t.replace(/{{[^#}]+}}/g,function(t){return"<span>"+t+"</span>"});return n}),this.Content=Lure.CreateElementFromString(t)),this.Target.appendChild(this.Content)}function construct(){this.Type=Type,this.Name=Name,this.AllContents=Lure.ContentList,this.Refresh=Refresh.bind(this),this.Select=function(t){return Lure.Select(t,$this.Content)},this.SelectAll=function(t){return Lure.SelectAll(t,$this.Content)},this.GetParent=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=$this;null!==e.Parent&&e.Name!==t;)e=e.Parent;return e},this.GetContent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=this.GetParent(t);if(e.Name===t)return e;var n=e;if("root"===t)return n;var i=function r(e){for(var i in e)if("Parent"!==i&&e[i]&&e[i].isContent){if(e[i].Name===t)return e[i];n=r(e[i])}return n};return i(n)},this.GetIndex=function(t){return t=$this.Select(t),Array.prototype.slice.call(t.parentElement.children).indexOf(t)},this.AddEventListener=function(t,e,n){Lure.AddEventListenerGlobal(t,e,n,$this.Content,$this)},this.AddTutor=function(t){$this.MonsieurTutor=new MonsieurTutor($this.Select(t),$this.Content)},this._SortBy=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(e.length<2)){console.log("sort by",t),e.sort(function(e,n){return e[t]<n[t]&&$this._Sorting[t].Sorted?1:e[t]>n[t]&&$this._Sorting[t].Sorted?-1:e[t]<n[t]&&!$this._Sorting[t].Sorted?-1:e[t]>n[t]&&!$this._Sorting[t].Sorted?1:0}),$this._Sorting[t].Sorted=!$this._Sorting[t].Sorted;for(var n in $this._Sorting)$this._Sorting.hasOwnProperty(n)&&"_sorter"!==n&&($this._Sorting[n].Target.classList.remove("mt-sorting-up"),$this._Sorting[n].Target.classList.remove("mt-sorting-down"),t!==n&&($this._Sorting[n].Sorted=!1));$this._Sorting[t].Target.classList.add($this._Sorting[t].Sorted?"mt-sorting-down":"mt-sorting-up"),$this.Refresh()}},this._FilterBy=function(){var t=performance.now(),e=0,n=$this._Filter._DataDefault.slice(0),i=function(t){$this._Filter.hasOwnProperty(t)&&$this._Filter[t].Filter&&""!==$this._Filter[t].Filter&&(n=n.filter(function(e){return e[t].toString().toLowerCase().indexOf($this._Filter[t].Filter)>-1}),e++)};for(var r in $this._Filter)i(r);console.log(n),0===e?($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,$this.Controller._Data)),$this.Controller.Refresh()):($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,n)),$this.Controller.PageSize=$this._PageSize,$this.Controller._PageCursor=0,$this.Controller._Rebuilder(n)),mr.PerformanceNow(t,"FilterBy")},Props.call(this);for(var k in GetSet)Object.defineProperty($this,k,Object.getOwnPropertyDescriptor(GetSet,k));if(Methods.call(this),this.Show=function(e){this.isActive=!0,this.Control&&this.Control.Active();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));if(duration<durationAni&&(duration=durationAni),duration++,"Untyped"===$this.Type||$this.isVisible||Lure.ContentList[$this.Type].forEach(function(t){t!==$this&&t.isActive&&t.Hide()}),Dialog){if(Lure._DialogCount++,$this.Content.classList.add("monsieur-dialog"),DialogWrapper){$this.DialogWrapper=Lure.CreateElementFromString('<div class="dialog-wrapper">'),document.body.appendChild($this.DialogWrapper),$this.DialogWrapper.onclick=$this.Hide.bind($this);var zIndexWrapper=parseInt(window.getComputedStyle($this.DialogWrapper).zIndex),zIndexContent=parseInt(window.getComputedStyle($this.Content).zIndex);(Number.isNaN(zIndexContent)||zIndexContent<zIndexWrapper)&&($this.Content.style.zIndex=zIndexWrapper+1)}DialogBlur&&($this.DialogWrapper.style.background="none",Lure.Select(DialogBlur).classList.add("monsieur-blur")),DialogAnimation&&$this.Content.classList.add(DialogAnimation)}BeforeShow.call($this,e),Shower.call($this,e),$this.Content.style.display="",clearTimeout($this.__private.ToggleTimer),null!==Show&&($this.__private.ToggleTimer=setTimeout(function(){Show.call($this,e)},duration))},this.Hide=function(e){this.isActive=!1,this.Control&&this.Control.Disactive();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));duration<durationAni&&(duration=durationAni),duration++,Dialog&&(Lure._DialogCount--,$this.DialogWrapper&&$this.DialogWrapper.remove(),DialogBlur&&Lure._DialogCount<1&&Lure.Select(DialogBlur).classList.remove("monsieur-blur")),Hider.call($this,e),clearTimeout($this.__private.ToggleTimer),null!==Hide&&($this.__private.ToggleTimer=setTimeout(function(){Hide.call($this,e)},duration))},this.Toggle=function(t){$this.isVisible?$this.Hide(t):$this.Show(t)},this.__private={},this.__private.ToggleTimer=null,this.Control=new Lure.Plugin.Content.Control(Control,$this),this.Content.onclick=OnClick?OnClick.bind($this):null,Array.isArray(SubContent))for(var i=0;i<SubContent.length;i++)SubContent[i].Parent||(SubContent[i].Parent=$this),$this[SubContent[i].Name]=new Lure.Content(SubContent[i]);else for(var cname in SubContent)SubContent[cname].Parent=$this,SubContent[cname].Name=cname,$this[cname]=new Lure.Content(SubContent[cname]);if(this.TitleContent=Lure.Select(Title,this.Content),"Untyped"!==Type||Visible===!1||Dialog?("Untyped"!==Type&&Visible!==!0||Dialog&&Visible!==!0)&&(Visible=!1):Visible=!0,Visible?(this.Content.style.display="",this.Control&&this.Control.Active()):(this.isActive=!1,this.Content.style.display="none"),Controller&&(Controller.isController?(this.Controller=Controller,this.Controller.Parent=this):(Controller.Target||(Controller.Target=this.Content),Controller.Type||(Controller.Type="Templator"),Controller.Parent=this,this.Controller=new Lure.Plugin.Content.Controller[Controller.Type](Controller)),this.Controller.isHasEditable&&Lure._EditablesEventListenerRun($this.Content)),Sorting){$this._Sorting={},$this._Sorting._sorter=null;var _loop2=function(t){Sorting.hasOwnProperty(t)&&"_sorter"!==t&&($this._Sorting[t]={Target:$this.Select(Sorting[t]),Sorted:!1},$this._Sorting[t].Target.classList.add("mt-sorting"),$this._Sorting[t].Target.addEventListener("click",function(){$this._Sorting._sorter=t,$this._SortBy(t,$this.Controller._Data)}))};for(var f in Sorting)_loop2(f);console.info("mt-sortable",$this._Sorting)}if(Filtering){$this._Filter={},$this._Filter._DataDefault=$this.Controller._Data.slice(0);var _loop3=function(t){Filtering.hasOwnProperty(t)&&"_format"!==t&&($this._Filter[t]={Target:$this.Select(Filtering[t]),Filter:""},$this._Filter[t].Target.classList.add("mt-filtering"),$this._Filter[t].Target.innerHTML='<input type="text" class="mt-filtering-input">',$this._Filter[t].Target.querySelector(".mt-filtering-input").addEventListener("keyup",function(e){$this._Filter[t].Filter=e.target.value.toLowerCase(),$this._FilterBy()}))};for(var f in Filtering)_loop3(f)}Lure.ContentList[$this.Type]||(Lure.ContentList[$this.Type]=[]),Lure.ContentList[$this.Type].push(this),Array.from(this.Content.children).forEach(function(t){t.classList.contains("close")&&(t.onclick=function(t){$this.Hide(t)})}),setTimeout(function(){AfterBuild.call($this)},1)}var _ref$Target=_ref.Target,Target=void 0===_ref$Target?null:_ref$Target,_ref$Content=_ref.Content,Content=void 0===_ref$Content?null:_ref$Content,_ref$CSS=_ref.CSS,CSS=void 0===_ref$CSS?"":_ref$CSS,_ref$Name=_ref.Name,Name=void 0===_ref$Name?null:_ref$Name,_ref$Global=_ref.Global,Global=void 0!==_ref$Global&&_ref$Global,_ref$Title=_ref.Title,Title=void 0===_ref$Title?"":_ref$Title,_ref$Type=_ref.Type,Type=void 0===_ref$Type?"Untyped":_ref$Type,_ref$Visible=_ref.Visible,Visible=void 0===_ref$Visible?void 0:_ref$Visible,_ref$SubContent=_ref.SubContent,SubContent=void 0===_ref$SubContent?[]:_ref$SubContent,_ref$Dialog=_ref.Dialog,Dialog=void 0!==_ref$Dialog&&_ref$Dialog,_ref$DialogWrapper=_ref.DialogWrapper,DialogWrapper=void 0===_ref$DialogWrapper||_ref$DialogWrapper,_ref$DialogBlur=_ref.DialogBlur,DialogBlur=void 0===_ref$DialogBlur?null:_ref$DialogBlur,_ref$DialogAnimation=_ref.DialogAnimation,DialogAnimation=void 0===_ref$DialogAnimation?null:_ref$DialogAnimation,_ref$Show=_ref.Show,Show=void 0===_ref$Show?null:_ref$Show,_ref$Hide=_ref.Hide,Hide=void 0===_ref$Hide?null:_ref$Hide,_ref$Shower=_ref.Shower,Shower=void 0===_ref$Shower?function(){this.Content.style.display=""}:_ref$Shower,_ref$Hider=_ref.Hider,Hider=void 0===_ref$Hider?function(){this.Content.style.display="none"}:_ref$Hider,_ref$BeforeShow=_ref.BeforeShow,BeforeShow=void 0===_ref$BeforeShow?function(){}:_ref$BeforeShow,_ref$Refresh=_ref.Refresh,Refresh=void 0===_ref$Refresh?function(t,e){this.Controller&&this.Controller.Refresh(t,e)}:_ref$Refresh,_ref$Sorting=_ref.Sorting,Sorting=void 0!==_ref$Sorting&&_ref$Sorting,_ref$Filtering=_ref.Filtering,Filtering=void 0!==_ref$Filtering&&_ref$Filtering,_ref$OnClick=_ref.OnClick,OnClick=void 0===_ref$OnClick?null:_ref$OnClick,_ref$Controller=_ref.Controller,Controller=void 0===_ref$Controller?null:_ref$Controller,_ref$Control=_ref.Control,Control=void 0===_ref$Control?null:_ref$Control,_ref$Props=_ref.Props,Props=void 0===_ref$Props?function(){}:_ref$Props,_ref$Methods=_ref.Methods,Methods=void 0===_ref$Methods?function(){}:_ref$Methods,_ref$GetSet=_ref.GetSet,GetSet=void 0===_ref$GetSet?{}:_ref$GetSet,_ref$AfterBuild=_ref.AfterBuild,AfterBuild=void 0===_ref$AfterBuild?function(){}:_ref$AfterBuild,_ref$Disabled=_ref.Disabled,Disabled=void 0!==_ref$Disabled&&_ref$Disabled,_ref$Parent=_ref.Parent,Parent=void 0===_ref$Parent?null:_ref$Parent;if(_classCallCheck(this,LureContent),!Disabled){var $this=this;if(this.isContent=!0,this.isActive=!0,this.Parent=Parent,null!==Parent?(this.Target=Global?Lure.Select(Target):Lure.Select(Target,this.Parent.Content),null===this.Target&&(this.Target=this.Parent.Content)):null!==Target&&(this.Target=Lure.Select(Target)),null===Content?(this.Content=this.Target,construct.call($this)):null===Content.match(/<[^>]+>/)?(console.log("get load"),Lure.GetFileText(Content).then(function(t){MakeContent.call($this,t),construct.call($this)})):(MakeContent.call($this,Content),construct.call($this)),null===this.Content||null===this.Target)return void(this.isContent=!1);if(""!==CSS){var node=document.createElement("style");node.innerHTML=CSS,document.body.appendChild(node)}}}return _createClass(LureContent,[{key:"RefreshOne",value:function(t){this.Controller&&this.Controller.RefreshOne(t)}},{key:"Remove",value:function(t,e){this.Controller&&this.Controller.Remove(t,e)}},{key:"Add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Controller&&this.Controller.Add(t,e,n,i)}},{key:"Edit",value:function(t,e){this.Controller&&this.Controller.Edit(t,e)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactive(),delete this.Controller,delete this.Control}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(t){this.TitleContent.innerHTML=t}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:null},set:function(t){this.Controller&&(this.Controller.Data=t)}},{key:"Items",get:function(){return this.Controller?this.Controller.Items:null}}]),LureContent}(),Control:function(){function t(e,n){var i=this;_classCallCheck(this,t),null!==e&&e.length>0&&!function(){for(var t=i,r=function(i){e[i].Name||(e[i].Name="unnamed_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),t[e[i].Name]={Content:Lure.SelectAll(e[i].Target),_Content:e[i].Target,Type:e[i].Type?e[i].Type:"Untyped",isGlobal:e[i].Global,OnClick:e[i].OnClick?e[i].OnClick:n.Show,OnChange:e[i].OnChange,Active:function(){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.add("active")})},Disactive:function(){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.remove("active")})}},t[e[i].Name].Content.forEach(function(t){t.classList.add("pointer")}),e[i].Global?Lure.AddEventListenerGlobal("click",e[i].Target,function(r){Lure.SelectAll(e[i].Target).forEach(function(t){t.classList.remove("active")}),r.target.classList.add("active"),t[e[i].Name].OnClick&&t[e[i].Name].OnClick.call(n,r)}):t[e[i].Name].Content.forEach(function(r){r.onclick=function(r){Lure.ContentList[n.Type].forEach(function(t){t!==n&&t.Control&&t.Control.Disactive()}),t[e[i].Name].Content.forEach(function(t){t.classList.remove("active")}),r.currentTarget.classList.add("active"),t[e[i].Name].OnClick.call(n,r)}}),e[i].OnChange&&(e[i].Global?Lure.AddEventListenerGlobal("change",e[i].Target,function(t){e[i].OnChange.call(n,t)}):t[e[i].Name].Content.forEach(function(t){t.onchange=function(t){e[i].OnChange.call(n,t)}}))},o=0;o<e.length;o++)r(o)}()}return _createClass(t,[{key:"Active",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&this[e].Content.forEach(function(t){t.classList.add("active")})}},{key:"Disactive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&(this[e].Content.forEach(function(t){t.classList.remove("active")}),this[e].isGlobal&&Lure.SelectAll(this[e]._Content).forEach(function(t){t.classList.remove("active")}))}}]),t}(),Cecc:function t(){_classCallCheck(this,t)},Controller:{Templator:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?null:n,r=e.Data,o=void 0===r?[]:r,l=e.ListElement,a=void 0===l?".list_element":l,s=e.EmptyMessage,u=void 0===s?"":s,h=e.EmptyHide,d=void 0!==h&&h,c=e.PageSize,f=void 0===c?-1:c,C=e.DataCount,g=void 0===C?-1:C,_=e.PageGet,p=void 0===_?null:_,v=e.ShowAllButton,m=void 0===v||v,S=e.LineSave,$=void 0===S?function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};setTimeout(function(){i()},500)}:S,y=e.LineAdd,T=void 0===y?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};setTimeout(function(){e()},500)}:y,L=e.EditModeSwitch,b=void 0===L?null:L,D=(e.DataSaveAll,e.NoAnimation),A=void 0!==D&&D,w=e.NoBuild,E=void 0!==w&&w,B=e.BeforeBuild,P=void 0===B?function(){}:B,k=e.AfterBuild,H=void 0===k?function(){}:k,M=e.AfterAdd,N=void 0===M?function(){}:M,F=e.Parent,x=void 0===F?null:F;_classCallCheck(this,t);var G=this;this.isController=!0,null!==x?this.Content=Lure.Select(i,x.Content):this.Content=Lure.Select(i),this.Target=this.Content,this._Data=o,this.EmptyMessage=u,this.ListElement="",this.BeforeBuild=P.bind(this),this.AfterBuild=H.bind(this),this.AfterAdd=N.bind(this),this.Parent=x,this.PageSize=f,this._PageSize=f,this._DataCount=g>0?g:this._Data.length,this._PageCursor=0,this._PageGet=p,this.LineAdd=T,this.LineSave=$,this.Type=null,this.isShowAllButton=m,this.isNoAnimaton=A,this.isEmptyHide=d;var I=[];this._Dictionary=I;var O=function(){G._Data||(G._Data={});for(var t=0;t<I.length;t++)for(var e=0;e<I[t].fields.length;e++){var n=I[t].fields[e].Target.indexOf("attributes")>-1,i=I[t].fields[e].BuildValue(G._Data);n?I[t].obj.attributes[I[t].fields[e].Target.split(".")[1]].value=i:I[t].obj[I[t].fields[e].Target]=I[t].fields[e].BuildValue(G._Data)}};this._Rebuilder=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G._Data,e="";0===G._PageCursor&&G.Content.querySelectorAll(".mt-line, .mt-paginator, .mt-empty").forEach(function(t){t.remove()});var n=void 0,i=t.length;if(G._DataCount=g>0?g:i,G.PageSize>0){G._DataCount=G._DataCount>0?G._DataCount:t.length;var r=G.Content.querySelector(".mt-paginator");null!==r&&r.remove(),i=parseInt(G._PageCursor)+parseInt(G.PageSize),i>G._DataCount&&G._DataCount>0&&(i=G._DataCount),n=G._DataCount-i,n>G.PageSize&&(n=G.PageSize)}if("ItemList"===G.Type&&0===t.length&&""!==G.EmptyMessage&&!G.isEmptyHide){var o=G.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),l=document.createElement(o);return l.classList.add("mt-empty"),l.innerHTML=G.EmptyMessage,void G.Content.appendChild(l)}if("ItemList"===G.Type&&0===t.length&&G.isEmptyHide)return void(G.Content.style.display="none");if(0!==t.length){for(var a=G._PageCursor;a<i;a++)e+=G._LineBuilder(t[a],a,t.length);if(G.Content.children.length<1?G.Content.innerHTML=e:(e=Lure.CreateElementsFromString(e,G.Content.tagName),null!==e&&e.forEach(function(t){G.Content.appendChild(t)})),G.PageSize>0&&(G._PageCursor=i),G.PageSize>0&&G._PageCursor<G._DataCount){var s=void 0,u="<span>  (Не загружено "+(G._DataCount-G._PageCursor)+") </span>";G.isShowAllButton&&(u='<span> или </span><span class="mt-btn-nextAll dotted pointer"> Все ( '+(G._DataCount-G._PageCursor)+" )</span>");var h="table"===G.Content.tagName||"thead"===G.Content.tagName||"tbody"===G.Content.tagName;if(h){var d=G.Content.querySelector("tr:first-child th").length+1;s='<tr class="mt-paginator"><td colspan="'+d+'" class="element block-head"><span class="tpltr-next dotted pointer">Показать еще '+n+"</span>"+u+"</td></tr>",s=Lure.CreateElementFromString(s,G.Content.tagName)}else s=Lure.CreateElementFromString("<div class='mt-paginator'><span class=\"mt-btn-next dotted pointer\">Показать еще "+n+"</span>"+u+"</div>");var c=s.querySelector(".mt-btn-next");c.onclick=function(){G._PageCursor>=t.length?G._PageGet(G._PageCursor,G.PageSize,R):z()};var f=s.querySelector(".mt-btn-nextAll");f.onclick=function(){G.PageSize=G._DataCount,null!==G._PageGet?G._PageGet(G._PageCursor,G._DataCount-G._PageCursor,R):z()},G.Content.appendChild(s)}}};var z=function(){G.BeforeBuild(),"Refresh"===G.Type?O():"ItemList"===G.Type&&G._Rebuilder(),G.AfterBuild()},R=function(t){for(var e=0;e<t.length;e++)G._Data.push(t[e]);z()};if(this.FieldAdd=function(t){for(var e=t.attributes,n=[],i=-1,r=0;r<e.length;r++)e[r].value.indexOf("{{")>-1&&("value"!==e[r].name?n.push({Target:"attributes."+e[r].name,BuildValue:Lure.Compile(e[r].value)}):n.push({Target:e[r].name,BuildValue:Lure.Compile(e[r].value)}),i=0);t.childNodes.length<2&&t.innerHTML.indexOf("{{")>-1&&(n.push({Target:"innerHTML",BuildValue:Lure.Compile(t.innerHTML)}),i=0!==i?1:2),i>-1&&I.push({obj:t,fields:n})},this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;G.PageSize=G._PageSize,G._PageCursor=0,null!==t&&(G._Data=t),G.PageCursor=0,null===e?z():G.RefreshOne(e)},this.RefreshOne=function(t){var e=Lure.CreateElementFromString(G._LineBuilder(G._Data[t],t,G._Data.length),G.Content.tagName),n=G.Items[t];G.Items[t].parentNode.replaceChild(e,n)},this.Add=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];0===G._Data.length&&null!==G.Content.querySelector(".mt-empty")&&G.Content.querySelector(".mt-empty").remove();var r=document.createDocumentFragment(),o=document.createElement(G.Content.tagName),l=void 0;if(n){for(l=0,G.Items.forEach(function(t){console.log(t),console.log(t.dataset.line),t.dataset.line=parseInt(t.dataset.line)+1}),o.innerHTML=G._LineBuilder(t,0,G._Data.length+1);o.childNodes[0];)r.appendChild(o.childNodes[0]);e&&r.children[0].classList.add(e),i&&G._Data.unshift(t),G.Content.prepend(r)}else{for(l=G._Data.length,i||l--,o.innerHTML=G._LineBuilder(t,l,l+1);o.childNodes[0];)r.appendChild(o.childNodes[0]);e&&r.children[0].classList.add(e),i&&G._Data.push(t),G.Content.appendChild(r)}null!==G.LineAdd&&G.LineAdd(t,function(){var t=G.Content.querySelector("."+e);t&&t.classList.remove(e)}),G.AfterAdd(t,l)},this.Edit=function(t,e){console.log("edit itemData",e,t),Array.from(G.Items).filter(function(t){return parseInt(t.dataset.line)===e})[0].classList.add("editable-waiting"),G.LineSave(e,"$this",t,function(){G._Data[e]=t,G.RefreshOne(e)})},this.Remove=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];G.Content.querySelector('.mt-line[data-line="'+t+'"]').remove();for(var n=t;n<G.Items.length;n++)G.Items[n].dataset.line=parseInt(G.Items[n].dataset.line)-1,G.Items[n].querySelectorAll("[data-line]").forEach(function(t){t.dataset.line=parseInt(t.dataset.line)-1});e&&G._Data.splice(t,1),0===G._Data.length&&G.Refresh()},this.SwitchToEditMode=function(){Lure.Editable.EditMode=!0,Lure.SelectAll(".editable",G.Content).forEach(function(t){Lure.Editable.AddEdits(t)})},Array.isArray(this._Data)){this.Type="ItemList";var W=null!==a.match(/^[a-zA-Z0-9.,\-_ *#]+$/g);if(W){var q=this.Content.querySelector(a);q.classList.add("mt-line"),a=q.outerHTML,q.remove()}else{var V=a.match(/<[^>]+>/)[0],j=void 0,U=V.indexOf('class="');U<0?j=V.substr(0,V.length-1)+' class="mt-line"'+V.substr(V.length-1):(U=V.indexOf('"',U+8),j=V.substr(0,U)+" mt-line"+V.substr(U)),a=a.replace(V,j)}a=a.replace(/<[\s\S]+?(>)/,function(t,e){return t.replace(e,' data-line="{{i}}">')}),this.ListElement=a,this._LineBuilder=Lure.Compile(a,!0),null!==a.match(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/)&&(this.isHasEditable=!0,null!==b&&Lure.Select(b).addEventListener("change",function(t){t.currentTarget.checked?G.SwitchToEditMode():(Lure.Editable.EditMode=!1,document.body.click())})),this.Content.MonsieurController=this,this.Content.classList.add("mt-content")}else{this.Type="Refresh";var Z=Array.prototype.slice.call(this.Content.querySelectorAll("*:not(g):not(path):not(clipPath):not(text):not(br)"));Z.push(this.Content),Z.forEach(function(t){G.FieldAdd(t)})}Lure.TemplatorList.push(this),E||z()}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}},{key:"Items",get:function(){return this.Content.querySelectorAll(".mt-line")}}]),t}(),TreeBuilder:function(){function t(e){var n=e.Target,i=void 0===n?null:n,r=e.Data,o=void 0===r?[]:r,l=e.ListElement,a=void 0===l?null:l,s=e.Drop,u=void 0!==s&&s,h=e.SubSelector,d=void 0===h?null:h,c=e.SubSelectorHandler,f=void 0===c?function(){}:c,C=e.BeforeBuild,g=void 0===C?function(){}:C,_=e.AfterBuild,p=void 0===_?function(){}:_,v=e.Parent,m=void 0===v?null:v;_classCallCheck(this,t),this.isController=!0,this.Content=Lure.Select(i),this.Target=this.Content,this.Parent=m,this._Data=o,this.SubSelector=d,this.SubSelectorHandler=f.bind(this),this.BeforeBuild=g.bind(this),this.AfterBuild=p.bind(this);var S=u?"mtb-sub_tree dropable":"mtb-sub_tree",$=0,y=null===a?this.Content.innerHTML:a;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",y=y.replace(/^([\s\S]*)(<\/\w+>)$/,function(t,e,n){return n='<div class="'+S+'"></div>'+n,e+n})),this.LineBuilder=Lure.Compile(y,!0);var T=this,L=0,b=function A(t,e,n){L++;var i={$lvl:$,$key:e,$index:L,$j:n},r=Lure.CreateElementFromString(T.LineBuilder(t,L,null,i));r.classList.add("mtb-branch");for(var o in t){var l=t[o];if(Array.isArray(l)){$++;for(var a=0;a<l.length;a++)if(null===T.SubSelector)r.appendChild(A(l[a],o,a));else{r.classList.add("mtb-has_tree"),u&&r.classList.add("dropable");var s=r.querySelector(T.SubSelector);s.appendChild(A(l[a],o,a))}$--}}return r},D=function(){if(T.BeforeBuild(),Array.isArray(T._Data)){T.Content.innerHTML="",$++;for(var t=0;t<T._Data.length;t++)T.Content.appendChild(b(T._Data[t],"root",0));$--}else T.Content.appendChild(b(T._Data,"root",0));$=0,L=0,T.AfterBuild()};D(this._Data),this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T._Data;T._Data=t,D()}}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}}]),t}()}},Lure.Content=Lure.Plugin.Content.Content;var MonsieurTutor=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e);var i=this;this.TargetButton=Lure.Select(t),this.TargetContent=Lure.Select(n);var r='<div class="monsieur-tutor">\n                        <div class="cd-caption">\n                            <span>Шаг </span>\n                            <span class="monsieur-tutor_step"></span>\n                        </div>\n                        <div class="monsieur-tutor_desc"></div>\n                        <div class="monsieur-tutor_btns">\n                            <button class="button btn-tutor btn-tutor-stop">Прервать обучение</button>\n                            <button class="button btn-tutor btn-tutor-next">Далeе →</button></div>\n                   </div>';this.Content=Lure.CreateElementFromString(r),this.ContentBG=Lure.CreateElementFromString('<div class="monsieur-tutor-bg dialog-wrapper"></div>'),this.Content.style.display="none",this.ContentBG.style.display="none",this._Description=this.Content.querySelector(".monsieur-tutor_desc"),this._Step=this.Content.querySelector(".monsieur-tutor_step"),this._ButtonNext=this.Content.querySelector(".btn-tutor-next"),this._ButtonStop=this.Content.querySelector(".btn-tutor-stop"),i.Data=[];var o=this._ButtonNext.innerHTML,l=0,a=document.createElement("div");a.style.display="none",document.body.appendChild(a);var s=window.getComputedStyle(a).backgroundColor;a.remove();var u=function(){var t=i.Data[l-1].obj;if("tr"!==t.tagName.toLowerCase())return t.style.zIndex="",t.style.position="",t.style.outline="",t.style.display="",void(t.style.backgroundColor="");var e=t.querySelectorAll("th, td");e.forEach(function(t){t.style.position="",t.style.zIndex=""})},h=function(t){if("tr"!==t.tagName.toLowerCase()){t.style.zIndex="11",t.style.position="relative",t.style.outline="5px #bee0ff solid";var e=window.getComputedStyle(t);return e.backgroundColor===s&&(t.style.backgroundColor="#fff"),void(Lure.isVisible(t)||("table"!==t.tagName.toLowerCase()?t.style.display="block":t.style.display="table"))}var n=t.querySelectorAll("th, td");n.forEach(function(t){t.style.zIndex="11",t.style.position="relative";var e=window.getComputedStyle(t);e.backgroundColor===s&&(t.style.backgroundColor="#fff")})},d=function(){if(console.log("tutor run"),null!==i.TargetContent){var t=i.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(t.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");t.forEach(function(t){i.Data.push({obj:t,desc:t.dataset.tutor})}),i.Content.style.display="",i.ContentBG.style.display="",c()}},c=function(){if(l>0&&u(),l===i.Data.length)return void f();var t=i.Data[l].obj,e=i.Data[l].desc,n=e.match(/{([\s\S]+)}/);null!==n&&(n=n[1],e=e.replace(/{([\s\S]+)}/,""),t=t.closest(n),i.Data[l].obj=t),h(t),i._Step.innerHTML=l+1+"/"+i.Data.length,i._Description.innerHTML=e,l+1===i.Data.length&&(i._ButtonNext.innerHTML="Завершить",i._ButtonStop.style.opacity="0");var r=t.offsetLeft+t.clientWidth+10,o=t.offsetTop-i.Content.clientHeight-10;o<10&&(o=10),r+i.Content.clientWidth>window.innerWidth&&(r=t.offsetLeft-i.Content.clientWidth-10,window.innerWidth<i.Content.clientWidth+t.clientWidth&&(r=t.offsetLeft+t.clientWidth-i.Content.clientWidth-20)),(document.documentElement.scrollTop>o||document.documentElement.scrollTop+window.innerHeight<t.offsetTop+t.offsetHeight)&&(document.documentElement.scrollTop=o-10+"px"),r<10&&(r=10),i.Content.style.left=r+"px",i.Content.style.top=o+"px",l++},f=function(){u(),i.Content.style.display="none",i.ContentBG.style.display="none",i._ButtonNext.innerHTML=o,i._ButtonStop.style.opacity="",l=0,i.Data=[]};this.TargetButton.onclick=d,this._ButtonNext.onclick=c,this._ButtonStop.onclick=f,document.body.appendChild(this.Content),document.body.appendChild(this.ContentBG),this.Run=d},MonsieurLoading=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?"body":n;_classCallCheck(this,t),this.Target=Lure.Select(i),this.Target.style.position="relative",this.Content=Lure.CreateElementFromString('<div class="ajax-loading" style="display: none"></div>');var r=60,o=60,l=function(t,e){for(var n=" M "+(r+t)+" "+o,i=0;i<e;i++){var l=i*(Math.PI/180),a=r+Math.cos(l)*t,s=o+Math.sin(l)*t;n+=" L "+a+" "+s}return n},a='<svg xmlns="http://www.w3.org/2000/svg">\n                     <path d="'+l(45,160)+'" class="monsieur-arc1" fill="none" stroke="#449b22" stroke-width="5"></path>\n                     <path d="'+l(40,130)+'" class="monsieur-arc2" fill="none" stroke="#61c8de" stroke-width="5"></path>\n                     <path d="'+l(35,100)+'" class="monsieur-arc3" fill="none" stroke="#761c19" stroke-width="5"></path>\n                     <path d="'+l(30,70)+'"  class="monsieur-arc4" fill="none" stroke="#333333" stroke-width="5"></path>\n                   </svg>';this.Target.appendChild(this.Content),this.Content.innerHTML=a,this.Timeout=null}return _createClass(t,[{key:"Show",value:function(){var t=this;this.Content.style.display="",clearTimeout(this.TimeoutHide),this.Timeout=setTimeout(function(){t.Content.style.display="block"},70)}},{key:"Hide",value:function(){var t=this;clearTimeout(this.Timeout),this.TimeoutHide=setTimeout(function(){t.Content.style.display="none"},250)}}]),t}(),MonsieurTooltip=function n(t){var e=t.Target,i=void 0===e?document:e,r=t.Attribute,o=void 0===r?"data-tooltip":r,l=t.Delay,a=void 0===l?400:l,s=t.Time,u=void 0===s?1100:s,h=(t.Cursor,t.Custom),d=void 0===h?'<div class="monsieur-tooltip">':h,c=t.AfterBuild,f=void 0===c?function(){}:c;_classCallCheck(this,n);var C=this;this.ToolTip=Lure.CreateElementFromString(d);var g=null,_=null;this.Target=Lure.Select(i);var p=function(t){this.ToolTip.innerHTML=t,C.Target.appendChild(this.ToolTip)}.bind(this);Lure.AddEventListenerGlobal("mouseover","["+o+"]",function(t){var e=t.currentTarget.dataset[o.replace("data-","")];clearTimeout(_),g=setTimeout(function(){p(e)},a)},this.Target),Lure.AddEventListenerGlobal("mouseout","["+o+"]",function(t){clearTimeout(g),_=setTimeout(function(){},u)},this.Target),setTimeout(function(){f.bind(C)},0)};
//# sourceMappingURL=lure.content.min.js.map
